(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{148:function(e,t,a){},202:function(e,t,a){},220:function(e,t,a){e.exports=a(664)},335:function(e,t,a){},339:function(e,t,a){var n={"./img1.jpg":340,"./img10.jpg":341,"./img11.jpg":342,"./img12.jpg":343,"./img13.jpg":344,"./img14.jpg":345,"./img15.jpg":346,"./img16.jpg":347,"./img17.jpg":348,"./img2.jpg":349,"./img3.jpg":350,"./img4.jpg":351,"./img5.jpg":352,"./img6.jpg":353,"./img7.jpg":354,"./img8.jpg":355,"./img9.jpg":356};function i(e){var t=r(e);return a(t)}function r(e){var t=n[e];if(t+1)return t;var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}i.keys=function(){return Object.keys(n)},i.resolve=r,(e.exports=i).id=339},340:function(e,t,a){e.exports=a.p+"static/media/img1.3351d8f8.jpg"},341:function(e,t,a){e.exports=a.p+"static/media/img10.39e739c8.jpg"},342:function(e,t,a){e.exports=a.p+"static/media/img11.e2702cdd.jpg"},343:function(e,t,a){e.exports=a.p+"static/media/img12.88a76fdb.jpg"},344:function(e,t,a){e.exports=a.p+"static/media/img13.366199ec.jpg"},345:function(e,t,a){e.exports=a.p+"static/media/img14.8585d4a4.jpg"},346:function(e,t,a){e.exports=a.p+"static/media/img15.9a5b0b40.jpg"},347:function(e,t,a){e.exports=a.p+"static/media/img16.331a8661.jpg"},348:function(e,t,a){e.exports=a.p+"static/media/img17.8b7b57fc.jpg"},349:function(e,t,a){e.exports=a.p+"static/media/img2.5f0110bf.jpg"},350:function(e,t,a){e.exports=a.p+"static/media/img3.fad77519.jpg"},351:function(e,t,a){e.exports=a.p+"static/media/img4.32cf8853.jpg"},352:function(e,t,a){e.exports=a.p+"static/media/img5.1a6f3ceb.jpg"},353:function(e,t,a){e.exports=a.p+"static/media/img6.dadad061.jpg"},354:function(e,t,a){e.exports=a.p+"static/media/img7.1c35e8bb.jpg"},355:function(e,t,a){e.exports=a.p+"static/media/img8.7f8bb6f5.jpg"},356:function(e,t,a){e.exports=a.p+"static/media/img9.1bcce4d0.jpg"},358:function(e,t,a){},660:function(e,t,a){e.exports=a.p+"static/media/avator.8bf53cd0.jpeg"},664:function(e,t,a){"use strict";function n(e){return{type:U,nav:e}}function i(e){return{type:B,isLogined:e}}function r(e){return{type:V,isAdmin:e}}function c(e){return X("".concat(Z,"/api/uploadImg"),e)}function s(e){return K("".concat(Z,"/api/imgs/").concat(e._id,"/remove?imgName=").concat(e.imgName,"&groupId=").concat(e.group_id))}function o(e){return K("".concat(Z,"/api/imgs/").concat(e,"/addImgFavor"))}function l(e,t){return K("".concat(Z,"/api/articles/").concat(e,"?typeNum=").concat(t))}function u(e,t){return Q("".concat(Z,"/api/").concat(e,"/comment"),t)}function m(e){return K("".concat(Z,"/api/articleTags"))}function p(e,t){return{type:ie,imgs:e,pageNum:t}}function h(e){return{type:re,img:e}}function d(e){return{type:ce,imgIndex:e}}function g(e,t){return{type:se,index:e,likeType:t}}function f(e,t){return{type:oe,articles:e,pageNum:t}}function v(e){return{type:ue,article:e}}function b(e){return{type:me,tags:e}}a.r(t);var E=a(0),y=a.n(E),j=a(6),N=a.n(j),k=a(66),O=a(18),I=a(9),C=a(10),x=a(13),w=a(11),S=a(12),A=a(677),T=a(665),R=a(45),L=a.n(R),M=a(68),_=a(36),D=a(671),H=a(675),F=a(100),P=a(26),U="CHANGE_CUR_NAV",B="CHANGE_LOGIN_STATUS",V="CHANGE_USER_TYPE",z="CHANGE_SHOW_MUSIC",q="SET_LIKES",G=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||(0===a.props.type?ee(t).then(function(e){a.handleResult(e)}):$(t).then(function(e){a.handleResult(e)}))})},a.state={btnText:"\u6ce8\u518c"},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){this.setState({btnText:0===this.props.type?"\u6ce8 \u518c":"\u767b \u5f55"})}},{key:"handleResult",value:function(e){var t=e.data;console.log("data===",t),t&&(window.sessionStorage.setItem("type",t.user.type),window.sessionStorage.setItem("user","\u6765\u81ea".concat(t.user.source,"\u7684").concat(t.user.name)),_.toast.dismiss(),this.props.changeLoginStatus(!0),this.props.changeUserType(1===t.user.type))}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return y.a.createElement(D.a,{onSubmit:this.handleSubmit,className:"login-form"},0===this.props.type&&y.a.createElement("div",null,y.a.createElement(D.a.Item,{label:"\u4e00\u4e2a\u6765\u81ea"},e("source",{rules:[{required:!0,message:"\u6211\u8981\u77e5\u9053\u4f60\u4ece\u54ea\u91cc\u6765\u554a\u670b\u53cb"}]})(y.a.createElement(H.a,{placeholder:"\u793e\u4ea4\u5e73\u53f0"}))),y.a.createElement(D.a.Item,{label:"\u7684"},e("name",{rules:[{required:!0,message:"\u6211\u8981\u77e5\u9053\u4f60\u7684\u540d\u5b57\u554a\u670b\u53cb"}]})(y.a.createElement(H.a,{placeholder:"\u5c0f\u53ef\u7231"})))),y.a.createElement(D.a.Item,{label:"\u90ae\u7bb1"},e("email",{rules:[{required:!0,message:"\u8f93\u5165\u90ae\u7bb1"}]})(y.a.createElement(H.a,{placeholder:"\u90ae\u7bb1(\u63a5\u6536\u8bc4\u8bba\u56de\u590d)"}))),y.a.createElement(D.a.Item,{label:"\u5bc6\u7801"},e("password",{rules:[{required:!0,message:"\u8f93\u5165\u5bc6\u7801"}]})(y.a.createElement(H.a,{type:"password",placeholder:"\u5bc6\u7801"}))),y.a.createElement(D.a.Item,null,y.a.createElement(F.a,{type:"primary",htmlType:"submit",className:"login-form-button"},this.state.btnText)))}}]),t}(y.a.Component),W=D.a.create({name:"normal_login"})(G),J=Object(O.b)(function(e){return{isLogined:e.commonReducer.isLogined}},function(e){return{changeLoginStatus:function(t){e(i(t))},changeUserType:function(t){e(r(t))},setLikes:function(t){e(function(e){return{type:q,likes:e}}(t))}}})(W),Y="include",K=function(){var e=Object(M.a)(L.a.mark(function e(t){var a,n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:Y});case 3:return a=e.sent,e.next=6,a.json();case 6:if(500!==(n=e.sent).resCode){e.next=13;break}if(_.toast.error(n.message,{position:_.toast.POSITION.TOP_RIGHT}),401===n.resCode)return console.log("USER_INVALID"),e.abrupt("return");e.next=12;break;case 12:throw new Error(n.message);case 13:return e.abrupt("return",{data:n});case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",{code:-2,message:e.t0.message});case 19:case"end":return e.stop()}},e,this,[[0,16]])}));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=Object(M.a)(L.a.mark(function e(t,a){var n,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a),credentials:Y});case 3:return n=e.sent,e.next=6,n.json();case 6:if(200!==(i=e.sent).resCode)throw 401===i.resCode?(console.log("USER_INVALID"),Object(_.toast)(y.a.createElement(J,null),{autoClose:!1,closeOnClick:!1,draggable:!1})):_.toast.error(i.message,{position:_.toast.POSITION.TOP_RIGHT}),new Error(i.message);e.next=10;break;case 10:return e.abrupt("return",{data:i});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",{message:e.t0.message});case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(t,a){return e.apply(this,arguments)}}(),X=function(){var e=Object(M.a)(L.a.mark(function e(t,a){var n,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"POST",body:a});case 3:return n=e.sent,e.next=6,n.json();case 6:if(500===(i=e.sent).resCode)throw _.toast.error(i.message,{position:_.toast.POSITION.TOP_RIGHT}),new Error(i.message);e.next=10;break;case 10:return e.abrupt("return",{data:i});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",{code:-2,message:"\u672a\u77e5\u9519\u8bef"});case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(t,a){return e.apply(this,arguments)}}(),Z="http://www.huangchufeng.site",$=function(e){return Q("".concat(Z,"/api/user/login"),e)},ee=function(e){return Q("".concat(Z,"/api/user/register"),e)},te=(a(335),A.a.Link),ae=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).state={bgHeight:{height:document.documentElement.clientHeight+"px"}},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){this.screenChange()}},{key:"shouldComponentUpdate",value:function(e,t){return t.someData!==this.state.someData}},{key:"getLocationCity",value:function(){K("http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js").then(function(e){})}},{key:"screenChange",value:function(){var e=this;window.addEventListener("resize",function(){e.setState({bgHeight:{height:document.documentElement.clientHeight+"px"}})})}},{key:"render",value:function(){var e=this;return console.log("render"),y.a.createElement("div",{className:"home-page"},[{id:"first",text:"IV"},{id:"second",text:"HUSH"},{id:"third",text:"OHIO"},{id:"forth",text:"MYTH"}].map(function(t,n){var i={height:document.documentElement.clientHeight+"px",backgroundImage:"url(".concat(a(339)("./img"+Math.floor(17*Math.random()+1)+".jpg"),")"),backgroundSize:"cover"};return y.a.createElement("div",{key:n,id:t.id+"Page",className:"index-bg "+t.id,style:e.state.bgHeight},y.a.createElement("div",{className:"img",style:i}),y.a.createElement("div",{className:"mask",style:e.state.bgHeight},t.text),0===n&&y.a.createElement("ul",{className:"nav-ul"},y.a.createElement("li",null,y.a.createElement(T.a,{to:"/photograph"},"\u6444\u5f71")),y.a.createElement("li",null,y.a.createElement(T.a,{to:"/articles"},"\u535a\u5ba2"))))}),y.a.createElement(A.a,null,y.a.createElement("ul",{className:"anchor-list"},y.a.createElement("li",null,y.a.createElement(te,{href:"#firstPage",title:"01"})),y.a.createElement("li",null,y.a.createElement(te,{href:"#secondPage",title:"02"})),y.a.createElement("li",null,y.a.createElement(te,{href:"#thirdPage",title:"03"})),y.a.createElement("li",null,y.a.createElement(te,{href:"#forthPage",title:"04"})))))}}]),t}(E.Component),ne=a(30),ie="INIT_IMGS",re="ADD_IMG",ce="DELETE_IMG",se="ADD_IMG_FAVOR",oe="INIT_ARTICLES",le="DELETE_ARTICLE",ue="SET_CUR_ARTICLE",me="INIT_TAGS",pe="ADD_TAG",he="DELETE_TAG",de=Object(k.b)({imgsReducer:function(e,t){switch(e=e||{imgs:[],curImg:{}},t.type){case ie:return 1<t.pageNum?Object(P.a)({},e,{imgs:Object(ne.a)(e.imgs).concat(Object(ne.a)(t.imgs))}):Object(P.a)({},e,{imgs:t.imgs});case re:return Object(P.a)({},e,{imgs:[t.img].concat(Object(ne.a)(e.imgs))});case ce:return Object(P.a)({},e,{imgs:Object(ne.a)(e.imgs.slice(0,t.imgIndex)).concat(Object(ne.a)(e.imgs.slice(t.imgIndex+1)))});case se:var a=[];return e.imgs.forEach(function(e,n){if(a.push(e),n===t.index){var i=0===t.likeType?(e.likes||0)-1:(e.likes||0)+1;a[n].likes=i}}),Object(P.a)({},e,{imgs:a});default:return e}},articlesReducer:function(e,t){switch(e=e||{articles:[],curArticle:null,tags:[]},t.type){case oe:return 1<t.pageNum?Object(P.a)({},e,{articles:Object(ne.a)(e.articles).concat(Object(ne.a)(t.articles))}):Object(P.a)({},e,{articles:t.articles});case le:return Object(P.a)({},e,{articles:Object(ne.a)(e.articles.slice(0,t.articleIndex)).concat(Object(ne.a)(e.articles.slice(t.articleIndex+1)))});case ue:var a=t.article;return Object(P.a)({},e,{curArticle:a});case me:return Object(P.a)({},e,{tags:t.tags});case pe:return Object(P.a)({},e,{tags:[t.tag].concat(Object(ne.a)(e.tags))});case he:return Object(P.a)({},e,{tags:Object(ne.a)(e.tags.slice(0,t.tagIndex)).concat(Object(ne.a)(e.tags.slice(t.tagIndex+1)))});default:return e}},commonReducer:function(e,t){switch(e=e||{likes:[],changeMusic:"/about"===window.location.pathname,curNav:"",isLogined:Boolean(window.sessionStorage.getItem("user")),isAdmin:"1"===window.sessionStorage.getItem("type")},t.type){case U:return Object(P.a)({},e,{curNav:t.nav});case B:return Object(P.a)({},e,{isLogined:t.isLogined});case V:return console.log("isAdmin",t.isAdmin),Object(P.a)({},e,{isAdmin:t.isAdmin});case z:return Object(P.a)({},e,{changeMusic:t.changeMusic});case q:return Object(P.a)({},e,{likes:t.likes});default:return e}}}),ge=(a(357),a(358),a(467)),fe=a(666),ve=a(1),be=a.n(ve),Ee=a(15),ye=["rgba(106,10,171,.3)","rgba(199,0,125,.3)","rgba(52,21,176,.3)","rgba(68,3,111,.3)","rgba(64,19,175,.3)","rgba(166,0,166,.3)","rgba(108,0,108,.3)"],je=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).toImgDetailPage=function(e){a.context.router.history.push("/photograph/detail/".concat(e))},a.toGroupImg=function(e,t){e.stopPropagation(),a.context.router.history.push("/photograph/group/".concat(t))},a.state={imgBoxStyle:{background:ye[Math.floor(Math.random()*ye.length)],height:""},showGroupBtn:!1},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.onResizeHandler()}},{key:"componentDidMount",value:function(){this.setState({showGroupBtn:-1===this.context.router.history.location.pathname.indexOf("group")}),this.onResizeHandler(),window.onresize=this.resizeThrottle(this.onResizeHandler.bind(this),500,!0)}},{key:"onResizeHandler",value:function(){var e=this.refs.imgBox.clientWidth*(this.props.img.h/this.props.img.w);this.refs.imgBox.style.height=e+"px"}},{key:"resizeThrottle",value:function(e,t,a){var n=null;return function(){var i=this,r=arguments;a&&(e.apply(this,r),a=!1),n=n||setTimeout(function(){console.log("timer is null"),e.apply(i,r),n=null},t)}}},{key:"render",value:function(){var e=this;return y.a.createElement("div",{className:"img-wraper",onClick:this.toImgDetailPage.bind(this,this.props.img._id)},y.a.createElement("div",{className:"img-box",ref:"imgBox",style:this.state.imgBoxStyle},y.a.createElement("img",{src:this.props.img.src,alt:""})),y.a.createElement("div",{className:"img-cover"},y.a.createElement("div",{className:"operate-box"},y.a.createElement("div",null,y.a.createElement(Ee.a,{className:"heart-icon",type:"heart",onClick:function(t){return e.props.addImgFavor(t,e.props.img._id,e.props.index)}}),y.a.createElement("span",{className:"count-span"},this.props.img.likes||0),this.state.showGroupBtn&&y.a.createElement(Ee.a,{type:"switcher",className:"collection-icon",onClick:function(t){e.toGroupImg(t,e.props.img.group_id)}}),this.props.isAdmin&&y.a.createElement(Ee.a,{type:"delete",className:"collection-icon",onClick:function(t){e.props.onDeleteImg(t,e.props.img,e.props.index)}}))),y.a.createElement("div",{className:"info-box"},this.props.img.title)))}}]),t}(E.Component);je.contextTypes={router:be.a.object.isRequired};var Ne=a(211),ke=a.n(Ne),Oe=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).state={},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){var e=this;return y.a.createElement("div",null,0<this.props.imgs.length&&y.a.createElement(ke.a,{disableImagesLoaded:!1,updateOnEachImageLoad:!1,options:{transitionDuration:0}},this.props.imgs.map(function(t,a){return y.a.createElement(je,{img:t,key:a,index:a,addImgFavor:e.props.addImgFavor.bind(e),onDeleteImg:e.props.onDeleteImg.bind(e),isAdmin:e.props.isAdmin})})),0===this.props.imgs.length&&y.a.createElement("div",{style:{textAlign:"center"}},"\u6682\u65e0\u6570\u636e"))}}]),t}(E.Component);Oe.defaultProps={imgs:[]};var Ie=a(672),Ce=a(674),xe=a(203),we=function(e){function t(){var e,a;Object(I.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(x.a)(this,(e=Object(w.a)(t)).call.apply(e,[this].concat(i)))).state={previewVisible:!1,previewImage:"",fileList:[]},a.handleCancel=function(){return a.setState({previewVisible:!1})},a.handlePreview=function(e){a.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})},a.onUploadRemove=function(e){var t=e.uid;a.state.fileList.forEach(function(e,n){if(t===e.uid)return a.state.fileList.splice(n,1),!1}),a.setState({fileList:a.state.fileList}),a.props.getUploadList(a.state.fileList)},a.handleChange=function(e){var t=e.fileList;console.log("change",t)},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"upload",value:function(e){var t=new FormData;t.append(e.filename,e.file);var a=this;this.getImgWH(e.file,function(){c(t).then(function(t){200===t.data.resCode&&(a.state.fileList.push({name:t.data.fileName,status:"done",url:t.data.url,w:e.file.w,h:e.file.h}),a.state.fileList.forEach(function(e,t){e.uid=t}),a.setState({fileList:a.state.fileList}),a.props.getUploadList(a.state.fileList))})})}},{key:"getImgWH",value:function(e,t){var a=new FileReader;a.onload=function(a){var n=a.target.result,i=new Image;i.onload=function(){e.w=this.width,e.h=this.height,t()},i.src=n},a.readAsDataURL(e)}},{key:"render",value:function(){var e=this.state,t=e.previewVisible,a=e.previewImage,n=e.fileList,i=y.a.createElement("div",null,y.a.createElement(Ee.a,{type:"plus"}),y.a.createElement("div",{className:"ant-upload-text"},"Upload"));return y.a.createElement("div",{className:"clearfix"},y.a.createElement(Ie.a,{listType:"picture-card",multiple:!0,fileList:n,customRequest:this.upload.bind(this),onPreview:this.handlePreview,onRemove:this.onUploadRemove,onChange:this.handleChange},3<=n.length?null:i),y.a.createElement(Ce.a,{visible:t,footer:null,onCancel:this.handleCancel},y.a.createElement("img",{alt:"example",style:{width:"100%"},src:a})))}}]),t}(y.a.Component),Se=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).handleOk=function(e){a.props.form.validateFields(function(e,t){if(!e){var n={imgs:a.state.imgList,info:a.props.form.getFieldsValue()};(function(e){return Q("".concat(Z,"/api/imgs/publish"),e)})(n).then(function(e){var t=e.data;200===t.resCode&&(a.props.visibleHandler(!1),a.setState({imgList:[]}),a.props.form.resetFields(),t.imglist.forEach(function(e){e.title=n.info.title,a.props.onAddImg(e)}))})}})},a.handleCancel=function(e){a.props.visibleHandler(!1)},a.getUploadList=function(e){a.setState({imgList:e}),console.log("\u63a5\u53d7\u5b50\u7ec4\u4ef6filelist",a.state.imgList)},a.state={imgList:[]},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=["\u5efa\u7b51","\u4eba\u50cf","\u8857\u62cd","\u98ce\u666f","\u5176\u4ed6"],t=this.props.form.getFieldDecorator,a=xe.a.Option;return y.a.createElement(Ce.a,{width:"40%",title:"\u4e0a\u4f20\u7167\u7247",visible:this.props.visible,onOk:this.handleOk,onCancel:this.handleCancel},y.a.createElement(we,{getUploadList:this.getUploadList.bind(this)}),y.a.createElement(D.a,{layout:"inline",onSubmit:this.handleOk},y.a.createElement(D.a.Item,{label:"\u7c7b\u522b"},t("category",{initialValue:e[0]})(y.a.createElement(xe.a,{style:{width:100},onChange:this.handleTypeChange},e.map(function(e,t){return y.a.createElement(a,{key:t,value:e},e)})))),y.a.createElement(D.a.Item,{label:"\u6807\u9898"},t("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7167\u7247\u6807\u9898"}]})(y.a.createElement(H.a,{placeholder:"\u4e3a\u8fd9\u7ec4\u7167\u7247\u8d77\u4e2a\u540d\u5b57\u5427"})))))}}]),t}(E.Component),Ae=D.a.create({name:"artile-form"})(Se),Te=a(678),Re=a(676),Le=[{text:"\u6240\u6709\u6587\u7ae0"},{text:"\u7b14\u8bb0",type:0},{text:"\u751f\u6d3b",type:1},{text:"Tags",url:"/articles/tags"},{text:"\u6444\u5f71",url:"/photograph"}],Me=[{text:"\u6240\u6709\u7167\u7247"},{text:"\u5efa\u7b51"},{text:"\u4eba\u50cf"},{text:"\u8857\u62cd"},{text:"\u98ce\u666f"},{text:"\u5176\u4ed6"},{text:"\u535a\u5ba2",url:"/articles"}],_e=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).navClickHandler=function(e,t){if(e.child||e.url)a.props.changeCurNav("");else{var n="";a.setState({activeIndex:t,showMenu:!1}),0!==a.props.type?(n="/articles",void 0!==e.type&&(n+="?type=".concat(e.type)),a.props.handleNavChange&&a.props.handleNavChange(e.type)):(n="/photograph",n+="?type=".concat(e.text),a.props.handleNavChange&&a.props.handleNavChange(e.text)),a.context.router.history.push(n),a.props.changeCurNav&&a.props.changeCurNav(a.state.navArr[t].text)}},a.state={activeIndex:0,navArr:0===a.props.type?Me:Le,showMenu:!1,isLargeScreen:!0,loginText:"\u9000\u51fa"},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.documentElement.clientWidth<=960&&this.setState({isLargeScreen:!1}),"/about"===this.context.router.route.location.pathname?this.setState({activeIndex:this.state.navArr.length}):this.state.navArr.forEach(function(t,a){t.text!==e.props.formParentNav&&t.text!==e.props.curNav||e.setState({activeIndex:a})})}},{key:"clickAbout",value:function(){this.setState({activeIndex:this.state.navArr.length,showMenu:!1}),this.context.router.history.push("/about")}},{key:"toggleMenu",value:function(){this.setState({showMenu:!this.state.showMenu})}},{key:"quitHandle",value:function(){var e=this;K("".concat(Z,"/api/user/quit")).then(function(t){t&&(e.setState({isLogined:!1}),window.sessionStorage.removeItem("user"),window.sessionStorage.removeItem("type"),e.props.changeLoginStatus(!1),e.props.changeUserType(!1),e.context.router.history.push("/"))})}},{key:"loginHandle",value:function(e){Object(_.toast)(y.a.createElement(J,{type:e}),{autoClose:!1,closeOnClick:!1,draggable:!1}),this.setState({showMenu:!1})}},{key:"render",value:function(){var e=this;return y.a.createElement("div",null,y.a.createElement("div",{className:"page-header"},(this.state.isLargeScreen||this.state.showMenu)&&y.a.createElement("ul",{className:"img-nav-ul"},y.a.createElement("li",null,y.a.createElement(T.a,{to:"/"},y.a.createElement(Ee.a,{type:"home",className:"index-btn"}))),this.state.navArr.map(function(t,a){var n="";if(t.child){var i=y.a.createElement(Te.a,null,t.child.map(function(e,t){return y.a.createElement(Te.a.Item,{key:t},y.a.createElement("span",null,e))}));n=y.a.createElement(Re.a,{overlay:i,trigger:["click"]},y.a.createElement("span",{onClick:e.navClickHandler.bind(e,t.child,a)},t.text,y.a.createElement(Ee.a,{type:"down"})))}else n=t.url?y.a.createElement(T.a,{to:t.url},t.text):y.a.createElement("span",null,t.text);return y.a.createElement("li",{key:a,onClick:e.navClickHandler.bind(e,t,a),className:a===e.state.activeIndex?"active":""},n)}),y.a.createElement("li",{onClick:this.clickAbout.bind(this),className:this.state.navArr.length===this.state.activeIndex?"active":""},"\u5173\u4e8e"),y.a.createElement("li",{className:"to-index-link"},this.props.isLogined&&y.a.createElement("span",{className:"op-btn",onClick:this.quitHandle.bind(this)},"\u9000\u51fa"),!this.props.isLogined&&y.a.createElement("span",null,y.a.createElement("span",{className:"op-btn",onClick:this.loginHandle.bind(this,1)},"\u767b\u5f55 "),y.a.createElement("span",{className:"op-btn",onClick:this.loginHandle.bind(this,0)},"\u6ce8\u518c")))),!this.state.showMenu&&y.a.createElement("div",null,y.a.createElement(T.a,{to:"/"},y.a.createElement(Ee.a,{type:"home",className:"index-btn-1"})),y.a.createElement("span",{className:"current-nav"},this.props.curNav)),y.a.createElement("div",{className:"menu-icon",onClick:this.toggleMenu.bind(this)},!this.state.showMenu&&y.a.createElement("span",null,y.a.createElement(Ee.a,{type:"bars"})),this.state.showMenu&&y.a.createElement(Ee.a,{type:"close"}))),this.state.showMenu&&y.a.createElement("div",{className:"nav-mask",onClick:this.toggleMenu.bind(this)}))}}]),t}(E.Component);function De(e){var t=e.comments,a=t.length;return 1<a?a+=t.reduce(function(e,t){return(e.child?e.child.length:0)+(t.child?t.child.length:0)},0):t[0].child&&(a+=t[0].child.length),y.a.createElement(Ve.a,{dataSource:t,header:"".concat(a," \u6761\u8bc4\u8bba"),itemLayout:"horizontal",renderItem:function(e){return y.a.createElement(ze.a,e,e.child&&e.child.length&&y.a.createElement(Ve.a,{dataSource:e.child,itemLayout:"horizontal",renderItem:function(e){return y.a.createElement(ze.a,e)}}))}})}_e.contextTypes={router:be.a.object.isRequired};var He=Object(O.b)(function(e){return{curNav:e.commonReducer.curNav,isLogined:e.commonReducer.isLogined,isAdmin:e.commonReducer.isAdmin}},function(e){return{changeCurNav:function(t){e(n(t))},changeLoginStatus:function(t){e(i(t))},changeUserType:function(t){e(r(t))}}})(_e),Fe=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).state={},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"handleClick",value:function(){this.props.loadMore()}},{key:"render",value:function(){var e=this.props.show?"\u6b63\u5728\u52a0\u8f7d":"\u52a0\u8f7d\u66f4\u591a";return y.a.createElement("div",{className:"loading-wrap"},this.props.show&&y.a.createElement(ge.a,{size:"small"}),y.a.createElement("span",{onClick:this.handleClick.bind(this)},e," "))}}]),t}(E.Component),Pe=(a(202),function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).visibleHandler=function(e){a.setState({dialogVisible:e})},a.state={dialogVisible:!1,loading:!1,showLoading:!1,pageNum:1,pageSize:3,noMore:!0},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentWillMount",value:function(){!this.props.curNav||0<=["\u6240\u6709\u7167\u7247","\u6240\u6709\u6587\u7ae0","\u7b14\u8bb0","\u751f\u6d3b","Tags"].indexOf(this.props.curNav)?(this.props.changeCurNav("\u6240\u6709\u7167\u7247"),this.loadImgs()):this.loadImgs(this.props.curNav)}},{key:"loadImgs",value:function(e){var t=this,a=0<arguments.length&&void 0!==e?e:"",n={pageNum:this.state.pageNum,category:a,pageSize:this.state.pageSize};return 1===n.pageNum?(this.setState({loading:!0}),this.props.initImgs([],this.state.pageNum)):this.setState({showLoading:!0}),function(e){return K("".concat(Z,"/api/imgs?pageNum=").concat(e.pageNum,"&pageSize=").concat(e.pageSize,"&category=").concat(e.category))}(n).then(function(e){var a=e.data;a?(t.props.initImgs(a.imgs,t.state.pageNum),t.setState({showLoading:!1,loading:!1}),a.allCount<=n.pageNum*n.pageSize?t.setState({noMore:!0}):t.setState({noMore:!1})):t.setState({showLoading:!1,loading:!1,noMore:!0})})}},{key:"loadMore",value:function(){this.setState({pageNum:this.state.pageNum+1},function(){this.loadImgs()})}},{key:"handleDeleteImg",value:function(e,t,a){var n=this,i=t.src,r=t._id,c=t.group_id,o=(i=i.split("/"))[i.length-1];e.stopPropagation(),s({_id:r,imgName:o,group_id:c}).then(function(e){e.data&&n.props.deleteImg(a)})}},{key:"handleAddImgFavor",value:function(e,t,a){var n=this;e.stopPropagation(),o(t).then(function(e){var t=e.data;t&&n.props.addImgFavorCount(a,t.type)})}},{key:"handleNavChange",value:function(e){var t=this;this.setState({pageNum:1},function(){e="\u6240\u6709\u7167\u7247"===e?"":e,t.loadImgs(e)})}},{key:"render",value:function(){return y.a.createElement("div",null,y.a.createElement(He,{type:0,handleNavChange:this.handleNavChange.bind(this)}),y.a.createElement("div",{className:"container img-container"},this.props.isAdmin&&y.a.createElement(F.a,{type:"primary",className:"common-btn",onClick:this.visibleHandler.bind(this,!0)},"\u4e0a\u4f20\u7167\u7247"),y.a.createElement(Ae,{visible:this.state.dialogVisible,visibleHandler:this.visibleHandler,onAddImg:this.props.addImg}),y.a.createElement(ge.a,{spinning:this.state.loading},y.a.createElement(Oe,{imgs:this.props.imgs,addImgFavor:this.handleAddImgFavor.bind(this),onDeleteImg:this.handleDeleteImg.bind(this),isAdmin:this.props.isAdmin})),!this.state.noMore&&y.a.createElement(Fe,{show:this.state.showLoading,loadMore:this.loadMore.bind(this)})),y.a.createElement(fe.a,{target:function(){return document.getElementsByClassName("container")[0]}}))}}]),t}(E.Component)),Ue=Object(O.b)(function(e){return{imgs:e.imgsReducer.imgs,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin,likes:e.commonReducer.likes}},function(e){return{initImgs:function(t,a){e(p(t,a))},deleteImg:function(t){e(d(t))},addImg:function(t){e(h(t))},changeCurNav:function(t){e(n(t))},addImgFavorCount:function(t,a){e(g(t,a))}}})(Pe),Be=a(679),Ve=a(673),ze=a(667),qe=a(668),Ge=H.a.TextArea,We=function(e){function t(){var e,a;Object(I.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(x.a)(this,(e=Object(w.a)(t)).call.apply(e,[this].concat(i)))).state={submitting:!1,value:"",comments:[],placeholder:"\u8f93\u5165\u8bc4\u8bba\u5185\u5bb9...",receiver:null,textArea:null,belongId:""},a.handleSubmit=function(){if(a.state.value){a.setState({submitting:!0});var e={type:a.props.type,receiver:a.state.receiver||a.props.receiver,content:a.state.value,belongId:a.state.belongId};a.props.onSubmit(e,function(t){if(t.data&&t.data.comment){var n=t.data.comment,i={author:n.sender===a.props.receiver?"\u4f5c\u8005":window.sessionStorage.getItem("user"),avatar:n.avatar||"",content:a.state.value,created_at:n.created_at};e.belongId?(a.state.comments.forEach(function(t){if(t._id+""===e.belongId)return i.author+="\u56de\u590d@\u4f5c\u8005",t.child=[i].concat(Object(ne.a)(t.child)),!1}),a.setState({submitting:!1,value:"",comments:a.state.comments})):a.setState({submitting:!1,value:"",comments:[i].concat(Object(ne.a)(a.state.comments))})}else a.setState({submitting:!1})})}},a.handleChange=function(e){a.setState({value:e.target.value})},a.handleBlur=function(){a.state.value||a.setState({placeholder:"\u8f93\u5165\u8bc4\u8bba\u5185\u5bb9...",receiver:null,belongId:""})},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({comments:e.comments})}},{key:"replay",value:function(e,t,a){this.props.receiver===t&&(a="\u4f5c\u8005"),this.setState({placeholder:"\u56de\u590d".concat(a," :"),receiver:t,belongId:e}),this.textArea.focus()}},{key:"queryReceiverName",value:function(e){var t="";return this.state.comments.forEach(function(a){if(a._id===e)return t=a.senderInfo,!1}),t}},{key:"configComment",value:function(e){var t,a="";if(e.user&&e.user.avatar&&(a=e.user.avatar),e.avatar&&(a=e.avatar),t={avatar:a,content:y.a.createElement("p",null,e.content),datetime:e.created_at,child:e.child},e.isReceiver&&(t.actions=[y.a.createElement("span",{onClick:this.replay.bind(this,e.belongId||e._id,e.sender,e.author||e.senderInfo)},"\u56de\u590d")]),e.sender===this.props.receiver?t.author="\u4f5c\u8005":t.author=e.author||e.senderInfo,e.belongId){var n=this.queryReceiverName(e.belongId);n===t.author&&(n="\u4f5c\u8005"),t.author+="\u56de\u590d@".concat(n)}return t}},{key:"render",value:function(){var e=this,t=this.state,a=t.submitting,n=t.value,i=t.placeholder,r=this.state.comments.map(function(t){var a=e.configComment(t);return t.child&&(a.child=t.child.map(function(t){return e.configComment(t)})),a});return y.a.createElement("div",null,0<r.length&&y.a.createElement(De,{comments:r}),y.a.createElement(ze.a,{avatar:y.a.createElement(qe.a,{src:"",alt:""}),content:y.a.createElement("div",null,y.a.createElement(D.a.Item,null,y.a.createElement(Ge,{placeholder:i,ref:function(t){return e.textArea=t},rows:4,onBlur:this.handleBlur,onChange:this.handleChange,value:n})),y.a.createElement(D.a.Item,null,y.a.createElement(F.a,{className:"common-btn",htmlType:"submit",loading:a,onClick:this.handleSubmit,type:"primary"},"\u8bc4\u8bba")))}))}}]),t}(E.Component),Je=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).resizeImgHandler=function(){a.setState({imgEnlargeble:!a.state.imgEnlargeble})},a.handleSubmit=function(e,t){u(a.state.id,e).then(function(e){e&&t&&t(e)})},a.lastOrNextImg=function(e){a.getImgDetail(a.state.id,e)},a.toGroupImg=function(e){a.context.router.history.push("/photograph/group/".concat(e))},a.state={loading:!1,id:a.props.match.params.id,imgEnlargeble:!1,comments:[],img:{},curPage:0,clickTypeNum:0},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentWillMount",value:function(){this.getImgDetail(this.state.id)}},{key:"getImgDetail",value:function(e,t){var a=this;this.setState({loading:!0}),function(e,t){return K("".concat(Z,"/api/imgs/").concat(e,"?typeNum=").concat(t))}(e,t).then(function(e){var n=e.data;n&&(n.noMore?(Be.a.warning("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u5f20\u4e86",1),a.setState({clickTypeNum:t})):(a.setState({img:n.img[0],id:n.img[0]._id,clickTypeNum:0,comments:n.comment}),a.context.router.history.push("/photograph/detail/".concat(n.img[0]._id)),a.handleBrowser()),a.setState({loading:!1}))})}},{key:"handleBrowser",value:function(){var e=this;setTimeout(function(){var t;(t=e.state.id,K("".concat(Z,"/api/imgs/").concat(t,"/addImgPv"),{num:void 0})).then(function(t){if(t.data){var a=Object.assign(e.state.img,{pv:(e.state.img.pv||0)+1});e.setState({img:a})}})},2e3)}},{key:"clickImgFavorHandler",value:function(){var e=this;o(this.state.id).then(function(t){var a=t.data;if(a){var n=0===a.type?(e.state.img.likes||0)-1:(e.state.img.likes||0)+1,i=Object.assign(e.state.img,{likes:n});e.setState({img:i})}})}},{key:"goBack",value:function(){this.context.router.history.push("/photograph")}},{key:"render",value:function(){var e=this;return y.a.createElement("div",{className:"img-detail-page"},y.a.createElement(ge.a,{spinning:this.state.loading},y.a.createElement("div",{className:["img-switch-wraper",this.state.imgEnlargeble?"active":""].join(" ")},y.a.createElement("div",{className:"center-box"},!this.state.imgEnlargeble&&y.a.createElement(Ee.a,{type:"close",className:"icon close-icon",onClick:this.goBack.bind(this)}),y.a.createElement(Ee.a,{type:"left",className:"icon left-icon",onClick:this.lastOrNextImg.bind(this,-1)}),y.a.createElement("img",{src:this.state.img.src,alt:""}),y.a.createElement(Ee.a,{type:this.state.imgEnlargeble?"shrink":"arrows-alt",className:"icon size-icon",onClick:this.resizeImgHandler.bind(this)}),y.a.createElement(Ee.a,{type:"right",className:"icon right-icon",onClick:this.lastOrNextImg.bind(this,1)}))),y.a.createElement("div",{className:"detail-box"},y.a.createElement("div",{className:"operate-box"},y.a.createElement("div",null,y.a.createElement(Ee.a,{className:"icon heart-icon",type:"heart",onClick:this.clickImgFavorHandler.bind(this)}),y.a.createElement("span",{className:"count-span"},this.state.img.likes||0),y.a.createElement(Ee.a,{className:"icon",type:"eye"}),y.a.createElement("span",{className:"count-span"},this.state.img.pv||0),y.a.createElement(Ee.a,{type:"switcher",className:"icon collection-icon",onClick:function(t){e.toGroupImg(e.state.img.groupId)}}))),y.a.createElement("div",{className:"comment-wrap"},y.a.createElement(We,{type:1,receiver:this.state.img.author,comments:this.state.comments,onSubmit:this.handleSubmit.bind(this)})))))}}]),t}(E.Component);Je.contextTypes={router:be.a.object.isRequired};var Ye=Object(O.b)(function(e){return{imgs:e.imgs,curImg:e.curImg}},function(e){return{}})(Je),Ke=["3940933","3947469","428350031","448917907","19466001","29729012","16649839","1651735","21469678","410925920","425684928","466333783","400690256","19535983","4405800","3947469","4111185","18861490","462516170","417833085"],Qe=function(e){function t(){return Object(I.a)(this,t),Object(x.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){return y.a.createElement("div",{className:"music-wrap "+(this.props.changeMusic?"show":"hide")},y.a.createElement("iframe",{id:"musicFrame",title:"music",frameBorder:"no",border:"0",marginWidth:"0",marginHeight:"0",width:"200",height:"86",src:"//music.163.com/outchain/player?type=2&id=".concat(Ke[Math.floor(Math.random()*Ke.length)],"&auto=1&height=66")}))}}]),t}(E.Component),Xe=Object(O.b)(function(e){return{changeMusic:e.commonReducer.changeMusic}})(Qe),Ze=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).state={loading:!1,groupId:a.props.match.params.id,groupInfo:{}},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentWillMount",value:function(){this.loadImgs(),this.props.curNav||this.props.changeCurNav("\u6240\u6709\u7167\u7247")}},{key:"loadImgs",value:function(){var e,t=this;return this.setState({loading:!0}),this.props.initImgs([],1),(e=this.state.groupId,K("".concat(Z,"/api/groupImgs?groupId=").concat(e))).then(function(e){var a=e.data;a&&(t.setState({groupInfo:a.group.info}),t.props.initImgs(a.group.imgs,1)),t.setState({loading:!1})})}},{key:"handleDeleteImg",value:function(e,t,a){var n=this,i=t.src,r=t._id,c=t.group_id,o=(i=i.split("/"))[i.length-1];e.stopPropagation(),s({_id:r,imgName:o,group_id:c}).then(function(e){e.data&&n.props.deleteImg(a)})}},{key:"handleAddImgFavor",value:function(e,t,a){var n=this;e.stopPropagation(),o(t).then(function(e){e.data&&n.props.addImgFavorCount(a)})}},{key:"handleNavChange",value:function(e){this.setState({pageNum:1}),e="\u6240\u6709\u7167\u7247"===e?"":e,this.loadImgs(e)}},{key:"goBack",value:function(){this.context.router.history.push("/photograph")}},{key:"render",value:function(){return y.a.createElement("div",null,y.a.createElement(He,{type:0,handleNavChange:this.handleNavChange.bind(this)}),y.a.createElement(Xe,null),y.a.createElement("div",{className:"container img-container"},y.a.createElement(ge.a,{spinning:this.state.loading},y.a.createElement("div",{className:"group-info"},y.a.createElement("p",{className:"title"},this.state.groupInfo.title),y.a.createElement("ul",{className:"tag-list"},y.a.createElement("li",null,this.state.groupInfo.category)),y.a.createElement("p",{className:"date"},this.state.groupInfo.created_at)),y.a.createElement(Oe,{imgs:this.props.imgs,addImgFavor:this.handleAddImgFavor.bind(this),onDeleteImg:this.handleDeleteImg.bind(this),isAdmin:this.props.isAdmin}),y.a.createElement("div",{className:"group-info"},y.a.createElement(F.a,{onClick:this.goBack.bind(this)},"\u8fd4 \u56de")))))}}]),t}(E.Component);Ze.contextTypes={router:be.a.object.isRequired};var $e=Object(O.b)(function(e){return{imgs:e.imgsReducer.imgs,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initImgs:function(t,a){e(p(t,a))},deleteImg:function(t){e(d(t))},addImg:function(t){e(h(t))},changeCurNav:function(t){e(n(t))},addImgFavorCount:function(t){e(g(t))}}})(Ze),et=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).state={},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){var e=this.props.article;return y.a.createElement("div",{className:"article-wraper"},y.a.createElement("div",{className:["cover-box",e.cover_url?"":"no-cover"].join(" ")},y.a.createElement("img",{"v-if":e.cover_url,src:e.cover_url,alt:""})),y.a.createElement("div",{className:"info"},y.a.createElement("h3",{className:"title"},y.a.createElement("p",{onClick:this.props.viewDetail.bind(this,e._id)},e.title),this.props.isAdmin&&y.a.createElement("span",{className:"operate-btn"},y.a.createElement(Ee.a,{type:"delete",onClick:this.props.deleteArticle.bind(this,e._id,this.props.index,e.cover_url)}),y.a.createElement(Ee.a,{type:"edit",onClick:this.props.editArticle.bind(this,e._id)}))),y.a.createElement("p",{className:"time"},e.created_at,y.a.createElement("span",null,y.a.createElement(Ee.a,{type:"message",className:"icon"}),e.comments||0),y.a.createElement("span",null,y.a.createElement(Ee.a,{type:"fire",className:"icon"}),e.pv||0)),y.a.createElement("div",{className:"description"},e.description)))}}]),t}(E.Component);et.contextTypes={router:be.a.object.isRequired};var tt=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).state={},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"render",value:function(){var e=this;return y.a.createElement("div",null,0<this.props.articles.length&&y.a.createElement("div",null,this.props.articles.map(function(t,a){return y.a.createElement(et,{article:t,key:t._id,index:a,deleteArticle:e.props.deleteArticle.bind(e),editArticle:e.props.editArticle.bind(e),viewDetail:e.props.viewDetail.bind(e),isAdmin:e.props.isAdmin})})),0===this.props.articles.length&&y.a.createElement("div",{style:{textAlign:"center"}},"\u6682\u65e0\u6570\u636e"))}}]),t}(E.Component);tt.defaultProps={articles:[]},a(148);var at=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).onEditArticle=function(e){a.context.router.history.push("/articles/edit/".concat(e))},a.onViewDetail=function(e){a.context.router.history.push("/articles/detail/".concat(e))},a.state={loading:!1,showLoading:!1,pageNum:1,pageSize:10,noMore:!0},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentWillMount",value:function(){var e=this.context.router.route.location.search,t=e.substring(e.length-1),a=this.props.match.params.tag;if(t){this.loadArticles(t);var n="0"===t?"\u7b14\u8bb0":"\u751f\u6d3b";this.props.changeCurNav(n)}else a?this.props.getArticlesByTagName(a):this.loadArticles(),this.props.curNav||this.props.changeCurNav("\u6240\u6709\u6587\u7ae0")}},{key:"loadArticles",value:function(e){var t=this,a=0<arguments.length&&void 0!==e?e:"",n={pageNum:this.state.pageNum,pageSize:this.state.pageSize,type:a};1===n.pageNum?(this.setState({loading:!0}),this.props.initArticles([],this.state.pageNum)):this.setState({showLoading:!0}),function(e){return K("".concat(Z,"/api/articles?pageNum=").concat(e.pageNum,"&pageSize=").concat(e.pageSize,"&type=").concat(e.type))}(n).then(function(e){var a=e.data;a?(t.props.initArticles(a.articles,t.state.pageNum),t.setState({showLoading:!1,loading:!1}),a.allCount<=n.pageNum*n.pageSize?t.setState({noMore:!0}):t.setState({noMore:!1})):t.setState({showLoading:!1,loading:!1,noMore:!0})})}},{key:"loadMore",value:function(){this.setState({pageNum:this.state.pageNum+1},function(){this.loadArticles()})}},{key:"handleNavChange",value:function(e){var t=this;this.setState({pageNum:1},function(){t.loadArticles(e)})}},{key:"onDeleteArticle",value:function(e,t,a){var n=this,i="";a&&(i=(a=a.split("/"))[a.length-1]),function(e){return K("".concat(Z,"/api/articles/").concat(e.articleId,"/remove?coverName=").concat(e.coverName))}({articleId:e,coverName:i}).then(function(e){e.data&&n.props.deleteArticle(t)})}},{key:"render",value:function(){return y.a.createElement("div",null,y.a.createElement(He,{type:1,formParentNav:"\u6240\u6709\u6587\u7ae0",handleNavChange:this.handleNavChange.bind(this)}),y.a.createElement("div",{className:"container article-container"},this.props.isAdmin&&y.a.createElement(T.a,{to:"/articles/new"},"\u5199\u6587\u7ae0"),y.a.createElement(ge.a,{spinning:this.state.loading},y.a.createElement("div",null,y.a.createElement(tt,{articles:this.props.articles,deleteArticle:this.onDeleteArticle.bind(this),editArticle:this.onEditArticle.bind(this),viewDetail:this.onViewDetail.bind(this),isAdmin:this.props.isAdmin}),!this.state.noMore&&y.a.createElement(Fe,{show:this.state.showLoading,loadMore:this.loadMore.bind(this)}))),y.a.createElement(fe.a,{target:function(){return document.getElementsByClassName("container")[0]}})))}}]),t}(E.Component);at.contextTypes={router:be.a.object.isRequired};var nt=Object(O.b)(function(e){return{articles:e.articlesReducer.articles,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initArticles:function(t,a){e(f(t,a))},getArticlesByTagName:function(t){(function(e){return K("".concat(Z,"/api/tag/articles?tag=").concat(e))})(t).then(function(t){var a=t.data;a&&e(f(a.articles))})},deleteArticle:function(t){e(function(e){return{type:le,articleIndex:e}}(t))},changeCurNav:function(t){e(n(t))}}})(at),it=a(215),rt=a.n(it),ct=(a(658),function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).lastOrNextArticle=function(e){a.articleDetail(a.state.id,e)},a.handleSubmit=function(e,t){u(a.state.id,e).then(function(e){e&&t&&t(e)})},a.backListPage=function(){a.props.changeCurNav("")},a.state={loading:!1,id:a.props.match.params.id,comments:[],article:{},curPage:0,clickTypeNum:0,tags:[]},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"handleBrowser",value:function(){var e=this;setTimeout(function(){var t;(t=e.state.id,K("".concat(Z,"/api/articles/").concat(t,"/addArticlePv"))).then(function(t){if(t.data){var a=Object.assign(e.state.article,{pv:(e.state.article.pv||0)+1});e.setState({article:a})}})},2e3)}},{key:"componentWillMount",value:function(){this.articleDetail(this.state.id),this.props.changeCurNav("\u6587\u7ae0\u8be6\u60c5")}},{key:"articleDetail",value:function(e,t){var a=this,n=1<arguments.length&&void 0!==t?t:"";this.setState({loading:!0}),l(e,n).then(function(e){var t=e.data;t&&(t.noMore?(Be.a.warning("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u7bc7\u4e86",1),a.setState({clickTypeNum:n})):(a.setState({article:t.article[0],id:t.article[0]._id,clickTypeNum:0,comments:t.comment,tags:t.tags}),a.context.router.history.push("/articles/detail/".concat(t.article[0]._id)),a.handleBrowser())),a.setState({loading:!1})})}},{key:"clickArticleFavorHandler",value:function(){var e,t=this;console.log("click"),(e=this.state.id,K("".concat(Z,"/api/articles/").concat(e,"/addArticleFavor"))).then(function(e){var a=e.data;if(a){var n=0===a.type?(t.state.article.likes||0)-1:(t.state.article.likes||0)+1,i=Object.assign(t.state.article,{likes:n});t.setState({article:i})}})}},{key:"render",value:function(){var e;return this.state.article.created_at&&(e=this.state.article.created_at.replace(/-/g,".")),y.a.createElement("div",null,y.a.createElement(He,{type:1}),y.a.createElement("div",{className:"container article-detail-container"},y.a.createElement(ge.a,{spinning:this.state.loading},y.a.createElement("div",{className:"left"},y.a.createElement(T.a,{to:"/articles",onClick:this.backListPage.bind(this)},y.a.createElement(Ee.a,{type:"left",className:"back-btn"})),y.a.createElement("div",{className:"top-info-box"},y.a.createElement("h2",null,this.state.article.title),y.a.createElement("div",{className:"top-bottom"},y.a.createElement("span",null,e," Beijing"),y.a.createElement("span",{className:"browse-num"},y.a.createElement(Ee.a,{type:"fire",className:"fire-icon"}),this.state.article.pv||0),y.a.createElement("span",{className:"browse-num like-num",onClick:this.clickArticleFavorHandler.bind(this)},y.a.createElement(Ee.a,{type:"heart",className:"fire-icon"}),this.state.article.likes||0))),y.a.createElement("div",{className:"left-bottom-box"},y.a.createElement("ul",{className:"tag-list"},this.state.tags&&this.state.tags.map(function(e){return y.a.createElement("li",{key:e._id},e.name)})),this.state.article.description),y.a.createElement("div",{className:"control-box"},y.a.createElement("span",{onClick:this.lastOrNextArticle.bind(this,-1)},"\u4e0a\u4e00\u7bc7"),y.a.createElement("span",{onClick:this.lastOrNextArticle.bind(this,1)},"\u4e0b\u4e00\u7bc7"))),y.a.createElement("div",{className:"right"},y.a.createElement(rt.a,{className:"language-name-of-snippet",innerHTML:!0},this.state.article.content),y.a.createElement(We,{type:0,receiver:this.state.article.author,comments:this.state.comments,onSubmit:this.handleSubmit.bind(this)})))))}}]),t}(E.Component));ct.contextTypes={router:be.a.object.isRequired};var st=Object(O.b)(function(e){return{curArticle:e.articlesReducer.curArticle,articles:e.articlesReducer.articles}},function(e){return{changeCurNav:function(t){e(n(t))}}})(ct),ot=a(669),lt=a(670),ut=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||console.log("Received values of form: ",t)})},a.getFormData=function(){var e;return a.props.form.validateFields(function(t,n){t||(console.log("Received values of form: ",n),e=Object.assign({tags:a.state.selectedTags,coverName:a.state.coverName,coverUrl:a.state.coverUrl},a.props.form.getFieldsValue()))}),e},a.state={selectedTags:[],loading:!1,coverUrl:"",coverName:""},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){this.props.onRef(this),this.props.form.setFieldsValue({type:0})}},{key:"componentWillReceiveProps",value:function(e){e.article&&!this.props.article&&this.initForm(e.article)}},{key:"initForm",value:function(e){var t={type:e.type,title:e.title,description:e.description};this.setState({coverUrl:e.cover_url,selectedTags:e.tags.map(function(e){return e.name})}),this.props.form.setFieldsValue(t)}},{key:"handleTagChange",value:function(e){this.setState({selectedTags:e})}},{key:"onUploadCover",value:function(e){var t=this;this.setState({loading:!0}),this.props.uploadCover(e,function(e){200===e.data.resCode&&t.setState({coverUrl:e.data.url,loading:!1,coverName:e.data.fileName})})}},{key:"render",value:function(){var e=y.a.createElement("div",null,y.a.createElement(Ee.a,{type:this.state.loading?"loading":"plus"}),y.a.createElement("div",{className:"ant-upload-text"},"\u6587\u7ae0\u5c01\u9762")),t=xe.a.Option,a=this.props.form.getFieldDecorator,n=[];if(this.props.allTags)for(var i=0;i<this.props.allTags.length;i++)n.push(y.a.createElement(t,{key:this.props.allTags[i].name,value:this.props.allTags[i].name},this.props.allTags[i].name));return y.a.createElement(D.a,{onSubmit:this.handleSubmit,className:"artile-form"},y.a.createElement(ot.a,null,y.a.createElement(lt.a,{span:4},y.a.createElement(D.a.Item,null,a("type")(y.a.createElement(xe.a,{style:{width:100}},y.a.createElement(t,{value:0},"\u7b14\u8bb0"),y.a.createElement(t,{value:1},"\u751f\u6d3b"))))),y.a.createElement(lt.a,{span:20},y.a.createElement(D.a.Item,null,a("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u7ae0\u6807\u9898"}]})(y.a.createElement(H.a,{placeholder:"\u6587\u7ae0\u6807\u9898"}))))),y.a.createElement(D.a.Item,null,a("description",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u7ae0\u63cf\u8ff0"}]})(y.a.createElement(H.a,{placeholder:"\u63cf\u8ff0\u4e0b\u6587\u7ae0\u5427"}))),y.a.createElement(D.a.Item,null,y.a.createElement(ot.a,null,y.a.createElement(lt.a,{span:18},y.a.createElement(xe.a,{mode:"tags",placeholder:"\u9009\u62e9\u6807\u7b7e",value:this.state.selectedTags,onChange:this.handleTagChange.bind(this),style:{width:"100%"}},n)),y.a.createElement(lt.a,{span:2}),y.a.createElement(lt.a,{span:2},y.a.createElement(Ie.a,{listType:"picture-card",className:"cover-uploader",customRequest:this.onUploadCover.bind(this),showUploadList:!1},this.state.coverUrl?y.a.createElement("img",{src:this.state.coverUrl,alt:"cover"}):e)))))}}]),t}(y.a.Component),mt=D.a.create({name:"artile-form"})(ut),pt=a(216),ht=a.n(pt),dt=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).state={editorContent:""},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.onRef(this);var t=this.refs.editorElem;this.editor=new ht.a(t),this.editor.customConfig.uploadImgShowBase64=!0,this.editor.customConfig.onchange=function(t){e.setState({editorContent:t})},this.editor.create()}},{key:"componentWillReceiveProps",value:function(e){e.article&&!this.props.article&&(this.setState({editorContent:e.article.content}),this.editor.txt.html(e.article.content))}},{key:"getContent",value:function(){return{content:this.state.editorContent}}},{key:"render",value:function(){return y.a.createElement("div",{ref:"editorElem",className:"edit-wrapper"})}}]),t}(E.Component),gt=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).onRef=function(e){a.child=e},a.state={articleId:a.props.match.params.id},a}var a;return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentDidMount",value:(a=Object(M.a)(L.a.mark(function e(){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.articleId)return e.next=3,this.props.articleDetail(this.state.articleId);e.next=3;break;case 3:this.props.initTags();case 4:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.props.resetCurArticle()}},{key:"uploadCover",value:function(e,t){var a=new FormData;a.append(e.filename,e.file),c(a).then(function(e){200===e.data.resCode&&t&&t(e)})}},{key:"saveArticleHandler",value:function(){var e=this,t=this.form.getFormData();t&&(t=Object.assign(this.child.getContent(),t),this.state.articleId?function(e,t){return Q("".concat(Z,"/api/articles/").concat(e,"/update"),{article:t})}(this.state.articleId,t).then(function(t){t.data&&e.context.router.history.push("/articles")}):function(e){return Q("".concat(Z,"/api/articles/create"),{article:e})}(t).then(function(t){t.data&&e.context.router.history.push("/articles")}))}},{key:"render",value:function(){var e=this;return y.a.createElement("div",null,y.a.createElement(He,{type:1}),y.a.createElement("div",{className:"container edit-container"},y.a.createElement(mt,{wrappedComponentRef:function(t){return e.form=t},article:this.props.curArticle,allTags:this.props.tags,onRef:this.onRef,uploadCover:this.uploadCover}),y.a.createElement(dt,{onRef:this.onRef,article:this.props.curArticle}),y.a.createElement(F.a,{type:"primary",className:"common-btn operate-btn",onClick:this.saveArticleHandler.bind(this)},"\u53d1\u5e03"),y.a.createElement(F.a,{className:"operate-btn"},y.a.createElement(T.a,{to:"/articles"},"\u53d6\u6d88"))))}}]),t}(E.Component);gt.contextTypes={router:be.a.object.isRequired};var ft=Object(O.b)(function(e){return{curArticle:e.articlesReducer.curArticle,tags:e.articlesReducer.tags}},function(e){return{initTags:function(){m().then(function(t){var a=t.data;a&&e(b(a.tags))})},articleDetail:function(t,a){return l(t,1<arguments.length&&void 0!==a?a:"").then(function(t){var a=t.data;if(a){var n=Object.assign({tags:a.tags},a.article[0]);e(v(n))}})},resetCurArticle:function(){e(v(null))}}})(gt),vt=a(77),bt=a(682),Et=a(218),yt=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).handleClose=function(t){var n=0;try{a.props.tags.forEach(function(e,a){if(e._id===t._id)return n=a,!1})}catch(e){throw new Error("current deleted tag_id is not exist")}a.props.deleteTag(t._id,n)},a.showInput=function(){a.setState({inputVisible:!0},function(){return a.input.focus()})},a.handleInputChange=function(e){a.setState({inputValue:e.target.value})},a.handleInputConfirm=function(){var e=a.state.inputValue;a.props.addTag(e),a.setState({inputVisible:!1,inputValue:""})},a.saveInputRef=function(e){return a.input=e},a.forMap=function(e){var t=y.a.createElement(bt.a,{closable:!!a.props.isAdmin,onClose:function(t){t.preventDefault(),a.handleClose(e)}},y.a.createElement("span",{onClick:a.clickTagHandler.bind(Object(vt.a)(Object(vt.a)(a)),e.name)},e.name));return y.a.createElement("span",{key:e._id,style:{display:"inline-block"}},t)},a.state={inputVisible:!1,inputValue:""},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"clickTagHandler",value:function(e){this.props.clickTagHandler(e)}},{key:"render",value:function(){var e=this.state,t=e.inputVisible,a=e.inputValue,n=(this.props.tags||[]).map(this.forMap);return y.a.createElement("div",null,y.a.createElement("div",{style:{marginBottom:16}},y.a.createElement(Et.a,{enter:{scale:.8,opacity:0,type:"from",duration:100,onComplete:function(e){e.target.style=""}},leave:{opacity:0,width:0,scale:0,duration:200},appear:!1},n)),t&&y.a.createElement(H.a,{ref:this.saveInputRef,type:"text",size:"small",style:{width:78},value:a,onChange:this.handleInputChange,onBlur:this.handleInputConfirm,onPressEnter:this.handleInputConfirm}),!t&&this.props.isAdmin&&y.a.createElement(bt.a,{onClick:this.showInput,style:{background:"#fff",borderStyle:"dashed"}},y.a.createElement(Ee.a,{type:"plus"})," New Tag"))}}]),t}(E.Component),jt=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(x.a)(this,Object(w.a)(t).call(this,e))).state={},a}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.props.initTags(),setTimeout(function(){e.props.changeCurNav("Tags")},0)}},{key:"clickTagHandler",value:function(e){this.context.router.history.push("/articles/tags/".concat(e))}},{key:"render",value:function(){return y.a.createElement("div",null,y.a.createElement(He,{type:1,formParentNav:"Tags"}),y.a.createElement("div",{className:"container article-container"},y.a.createElement(yt,{isAdmin:this.props.isAdmin,tags:this.props.tags,initTags:this.props.initTags,addTag:this.props.addTag,deleteTag:this.props.deleteTag,clickTagHandler:this.clickTagHandler.bind(this)})))}}]),t}(E.Component);jt.contextTypes={router:be.a.object.isRequired};var Nt=Object(O.b)(function(e){return{tags:e.articlesReducer.tags,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initTags:function(){m().then(function(t){var a=t.data;a&&e(b(a.tags))})},deleteTag:function(t,a){(function(e){return K("".concat(Z,"/api/articleTags/").concat(e.tagId,"/remove"))})({tagId:t}).then(function(t){t.data&&e({type:he,tagIndex:a})})},addTag:function(t){(function(e){return Q("".concat(Z,"/api/articleTags/create"),e)})({name:t}).then(function(t){var a=t.data;a&&e(function(e){return{type:pe,tag:e}}(a.res))})},changeCurNav:function(t){e(n(t))}}})(jt),kt=function(e){function t(){return Object(I.a)(this,t),Object(x.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(C.a)(t,[{key:"componentWillMount",value:function(){var e=this;setTimeout(function(){e.props.changeCurNav("\u5173\u4e8e")},0),this.props.changeShowMusic(!0)}},{key:"changeSong",value:function(){var e=this;this.props.changeShowMusic(!1),setTimeout(function(){e.props.changeShowMusic(!0)},0)}},{key:"render",value:function(){return y.a.createElement("div",null,y.a.createElement(He,null),y.a.createElement("div",{className:"about-me"},y.a.createElement("img",{className:"avator",alt:"",src:a(660)}),y.a.createElement("div",null,y.a.createElement("p",null,"\u9ebb\u70e6\u8ba9\u6211\u4e00\u591c\u66b4\u5bcc \u5b9e\u5728\u4e0d\u884c\u7684\u8bdd \u534a\u4e2a\u6708\u4e5f\u884c \u4e00\u5e74\u4e5f\u53ef\u4ee5"),y.a.createElement("p",null,y.a.createElement("a",{target:"blank",href:"https://github.com/HuangChuFeng"},y.a.createElement(Ee.a,{type:"github"})," ",y.a.createElement("span",null,"github")),"\xa0\xa0\xa0\xa0",y.a.createElement("a",{target:"blank",href:"https://weibo.com/5454891945/profile"},y.a.createElement(Ee.a,{type:"weibo-circle"})," ",y.a.createElement("span",null,"__cranky"))),y.a.createElement("p",{onClick:this.changeSong.bind(this)},y.a.createElement("span",{className:"change-song-btn"},"\u6362\u6b4c")))))}}]),t}(E.Component),Ot=Object(O.b)(function(e){return{curNav:e.commonReducer.curNav}},function(e){return{changeShowMusic:function(t){e(function(e){return{type:z,changeMusic:e}}(t))},changeCurNav:function(t){e(n(t))}}})(kt),It=a(680),Ct=a(681),xt=(a(661),Object(k.c)(de));console.log("NODE_ENV","production"),N.a.render(y.a.createElement(O.a,{store:xt},y.a.createElement("div",null,y.a.createElement(Xe,null),y.a.createElement(It.a,null,y.a.createElement("div",null,y.a.createElement(Ct.a,{exact:!0,path:"/",component:ae}),y.a.createElement(Ct.a,{exact:!0,path:"/about",component:Ot}),y.a.createElement(Ct.a,{exact:!0,path:"/photograph",component:Ue}),y.a.createElement(Ct.a,{exact:!0,path:"/photograph/detail/:id",component:Ye}),y.a.createElement(Ct.a,{exact:!0,path:"/photograph/group/:id",component:$e}),y.a.createElement(Ct.a,{exact:!0,path:"/articles",component:nt}),y.a.createElement(Ct.a,{exact:!0,path:"/articles/detail/:id",component:st}),y.a.createElement(Ct.a,{exact:!0,path:"/articles/new",component:ft}),y.a.createElement(Ct.a,{exact:!0,path:"/articles/edit/:id",component:ft}),y.a.createElement(Ct.a,{exact:!0,path:"/articles/tags",component:Nt}),y.a.createElement(Ct.a,{exact:!0,path:"/articles/tags/:tag",component:nt}),y.a.createElement(_.ToastContainer,null))))),document.getElementById("root"))}},[[220,2,1]]]);