(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{146:function(e,t,a){},200:function(e,t,a){},218:function(e,t,a){e.exports=a(667)},333:function(e,t,a){},335:function(e,t,a){var n={"./img1.jpg":336,"./img10.jpg":337,"./img11.jpg":338,"./img12.jpg":339,"./img13.jpg":340,"./img14.jpg":341,"./img15.jpg":342,"./img16.jpg":343,"./img17.jpg":344,"./img18.jpg":345,"./img19.jpg":346,"./img2.jpg":347,"./img20.jpg":348,"./img21.jpg":349,"./img3.jpg":350,"./img4.jpg":351,"./img5.jpg":352,"./img6.jpg":353,"./img7.jpg":354,"./img8.jpg":355,"./img9.jpg":356};function i(e){var t=r(e);return a(t)}function r(e){var t=n[e];if(t+1)return t;var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}i.keys=function(){return Object.keys(n)},i.resolve=r,(e.exports=i).id=335},336:function(e,t,a){e.exports=a.p+"static/media/img1.55766957.jpg"},337:function(e,t,a){e.exports=a.p+"static/media/img10.6ef82308.jpg"},338:function(e,t,a){e.exports=a.p+"static/media/img11.1456acbf.jpg"},339:function(e,t,a){e.exports=a.p+"static/media/img12.f586510a.jpg"},340:function(e,t,a){e.exports=a.p+"static/media/img13.f2e7355b.jpg"},341:function(e,t,a){e.exports=a.p+"static/media/img14.ed1c46bb.jpg"},342:function(e,t,a){e.exports=a.p+"static/media/img15.aa980bce.jpg"},343:function(e,t,a){e.exports=a.p+"static/media/img16.e9f5f81d.jpg"},344:function(e,t,a){e.exports=a.p+"static/media/img17.7870f8a1.jpg"},345:function(e,t,a){e.exports=a.p+"static/media/img18.925b0eaf.jpg"},346:function(e,t,a){e.exports=a.p+"static/media/img19.c56227fb.jpg"},347:function(e,t,a){e.exports=a.p+"static/media/img2.b42a7d26.jpg"},348:function(e,t,a){e.exports=a.p+"static/media/img20.2d87b32e.jpg"},349:function(e,t,a){e.exports=a.p+"static/media/img21.48f00538.jpg"},350:function(e,t,a){e.exports=a.p+"static/media/img3.2b0e1b02.jpg"},351:function(e,t,a){e.exports=a.p+"static/media/img4.d9f2313e.jpg"},352:function(e,t,a){e.exports=a.p+"static/media/img5.fce9bada.jpg"},353:function(e,t,a){e.exports=a.p+"static/media/img6.2db6b735.jpg"},354:function(e,t,a){e.exports=a.p+"static/media/img7.dcdd651d.jpg"},355:function(e,t,a){e.exports=a.p+"static/media/img8.105257be.jpg"},356:function(e,t,a){e.exports=a.p+"static/media/img9.cf763aa6.jpg"},358:function(e,t,a){},663:function(e,t,a){e.exports=a.p+"static/media/avator.1daf912e.jpeg"},667:function(e,t,a){"use strict";function n(e){return{type:C,nav:e}}function i(e){return{type:x,isLogined:e}}function r(e){return{type:w,isAdmin:e}}a.r(t);var c=a(0),s=a.n(c),o=a(6),l=a.n(o),u=a(65),m=a(18),p=a(9),h=a(10),d=a(13),g=a(11),f=a(12),v=a(668),b=a(45),E=a.n(b),y=a(67),j=a(35),N=a(673),k=a(677),O=a(99),I=a(25),C="CHANGE_CUR_NAV",x="CHANGE_LOGIN_STATUS",w="CHANGE_USER_TYPE",S="CHANGE_SHOW_MUSIC",A="SET_LIKES",T=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||(0===a.props.type?ee(t).then(function(e){a.handleResult(e)}):$(t).then(function(e){a.handleResult(e)}))})},a.state={btnText:"\u6ce8\u518c"},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.setState({btnText:0===this.props.type?"\u6ce8 \u518c":"\u767b \u5f55"})}},{key:"handleResult",value:function(e){var t=e.data;console.log("data===",t),t&&(window.sessionStorage.setItem("type",t.user.type),window.sessionStorage.setItem("user","\u6765\u81ea".concat(t.user.source,"\u7684").concat(t.user.name)),j.toast.dismiss(),this.props.changeLoginStatus(!0),this.props.changeUserType(1===t.user.type))}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return s.a.createElement(N.a,{onSubmit:this.handleSubmit,className:"login-form"},0===this.props.type&&s.a.createElement("div",null,s.a.createElement(N.a.Item,{label:"\u4e00\u4e2a\u6765\u81ea"},e("source",{rules:[{required:!0,message:"\u6211\u8981\u77e5\u9053\u4f60\u4ece\u54ea\u91cc\u6765\u554a\u670b\u53cb"}]})(s.a.createElement(k.a,{placeholder:"\u793e\u4ea4\u5e73\u53f0"}))),s.a.createElement(N.a.Item,{label:"\u7684"},e("name",{rules:[{required:!0,message:"\u6211\u8981\u77e5\u9053\u4f60\u7684\u540d\u5b57\u554a\u670b\u53cb"}]})(s.a.createElement(k.a,{placeholder:"\u5c0f\u53ef\u7231"})))),s.a.createElement(N.a.Item,{label:"\u90ae\u7bb1"},e("email",{rules:[{required:!0,message:"\u8f93\u5165\u90ae\u7bb1"}]})(s.a.createElement(k.a,{placeholder:"\u90ae\u7bb1(\u63a5\u6536\u8bc4\u8bba\u56de\u590d)"}))),s.a.createElement(N.a.Item,{label:"\u5bc6\u7801"},e("password",{rules:[{required:!0,message:"\u8f93\u5165\u5bc6\u7801"}]})(s.a.createElement(k.a,{type:"password",placeholder:"\u5bc6\u7801"}))),s.a.createElement(N.a.Item,null,s.a.createElement(O.a,{type:"primary",htmlType:"submit",className:"login-form-button"},this.state.btnText)))}}]),t}(s.a.Component),R=N.a.create({name:"normal_login"})(T),L=Object(m.b)(function(e){return{isLogined:e.commonReducer.isLogined}},function(e){return{changeLoginStatus:function(t){e(i(t))},changeUserType:function(t){e(r(t))},setLikes:function(t){e(function(e){return{type:A,likes:e}}(t))}}})(R),_="include";function M(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}function D(e){return X("".concat(Z,"/api/uploadImg"),e)}function H(e){return e={_id:e._id,imgName:e.imgName,groupId:e.group_id},K("".concat(Z,"/api/imgs/").concat(e._id,"/remove"),e)}function F(e){return K("".concat(Z,"/api/imgs/").concat(e,"/addImgFavor"))}function U(e,t){return K("".concat(Z,"/api/articles/").concat(e),{typeNum:t})}function P(e,t){return Q("".concat(Z,"/api/").concat(e,"/comment"),t)}function B(e){return K("".concat(Z,"/api/articleTags"))}function V(e,t){return{type:ne,imgs:e,pageNum:t}}function z(e){return{type:ie,img:e}}function q(e){return{type:re,imgIndex:e}}function G(e,t){return{type:ce,index:e,likeType:t}}function W(e,t){return{type:se,articles:e,pageNum:t}}function J(e){return{type:le,article:e}}function Y(e){return{type:ue,tags:e}}var K=function(){var e=Object(y.a)(E.a.mark(function e(t,a){var n,i;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a&&(t+="?".concat(M(a))),e.prev=1,e.next=4,fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:_});case 4:return n=e.sent,e.next=7,n.json();case 7:if(500!==(i=e.sent).resCode){e.next=14;break}if(j.toast.error(i.message,{position:j.toast.POSITION.TOP_RIGHT}),401===i.resCode)return console.log("USER_INVALID"),e.abrupt("return");e.next=13;break;case 13:throw new Error(i.message);case 14:return e.abrupt("return",{data:i});case 17:return e.prev=17,e.t0=e.catch(1),e.abrupt("return",{code:-2,message:e.t0.message});case 20:case"end":return e.stop()}},e,this,[[1,17]])}));return function(t,a){return e.apply(this,arguments)}}(),Q=function(){var e=Object(y.a)(E.a.mark(function e(t,a){var n,i;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a),credentials:_});case 3:return n=e.sent,e.next=6,n.json();case 6:if(200!==(i=e.sent).resCode)throw 401===i.resCode?(console.log("USER_INVALID"),Object(j.toast)(s.a.createElement(L,null),{autoClose:!1,closeOnClick:!1,draggable:!1})):j.toast.error(i.message,{position:j.toast.POSITION.TOP_RIGHT}),new Error(i.message);e.next=10;break;case 10:return e.abrupt("return",{data:i});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",{message:e.t0.message});case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(t,a){return e.apply(this,arguments)}}(),X=function(){var e=Object(y.a)(E.a.mark(function e(t,a){var n,i;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"POST",body:a});case 3:return n=e.sent,e.next=6,n.json();case 6:if(500===(i=e.sent).resCode)throw j.toast.error(i.message,{position:j.toast.POSITION.TOP_RIGHT}),new Error(i.message);e.next=10;break;case 10:return e.abrupt("return",{data:i});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",{code:-2,message:"\u672a\u77e5\u9519\u8bef"});case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(t,a){return e.apply(this,arguments)}}(),Z="http://www.huangchufeng.site",$=function(e){return Q("".concat(Z,"/api/user/login"),e)},ee=function(e){return Q("".concat(Z,"/api/user/register"),e)},te=(a(333),function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={bgHeight:{height:document.documentElement.clientHeight+"px"}},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.screenChange()}},{key:"shouldComponentUpdate",value:function(e,t){return t.someData!==this.state.someData}},{key:"getLocationCity",value:function(){K("http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js").then(function(e){})}},{key:"screenChange",value:function(){var e=this;window.addEventListener("resize",function(){e.setState({bgHeight:{height:document.documentElement.clientHeight+"px"}})})}},{key:"render",value:function(){var e=this;return console.log("render"),s.a.createElement("div",{className:"home-page"},[{id:"first",text:"IV"},{id:"second",text:"HUSH"},{id:"third",text:"OHIO"},{id:"forth",text:"MYTH"}].map(function(t,n){var i={height:document.documentElement.clientHeight+"px",backgroundImage:"url(".concat(a(335)("./img"+Math.floor(20*Math.random()+1)+".jpg"),")"),backgroundSize:"cover"};return s.a.createElement("div",{key:n,id:t.id+"Page",className:"index-bg "+t.id,style:e.state.bgHeight},s.a.createElement("div",{className:"img",style:i}),s.a.createElement("div",{className:"mask",style:e.state.bgHeight},t.text),0===n&&s.a.createElement("ul",{className:"nav-ul"},s.a.createElement("li",null,s.a.createElement(v.a,{to:"/photograph"},"\u6444\u5f71")),s.a.createElement("li",null,s.a.createElement(v.a,{to:"/articles"},"\u535a\u5ba2"))))}))}}]),t}(c.Component)),ae=a(29),ne="INIT_IMGS",ie="ADD_IMG",re="DELETE_IMG",ce="ADD_IMG_FAVOR",se="INIT_ARTICLES",oe="DELETE_ARTICLE",le="SET_CUR_ARTICLE",ue="INIT_TAGS",me="ADD_TAG",pe="DELETE_TAG",he=Object(u.b)({imgsReducer:function(e,t){switch(e=e||{imgs:[],curImg:{}},t.type){case ne:return 1<t.pageNum?Object(I.a)({},e,{imgs:Object(ae.a)(e.imgs).concat(Object(ae.a)(t.imgs))}):Object(I.a)({},e,{imgs:t.imgs});case ie:return Object(I.a)({},e,{imgs:[t.img].concat(Object(ae.a)(e.imgs))});case re:return Object(I.a)({},e,{imgs:Object(ae.a)(e.imgs.slice(0,t.imgIndex)).concat(Object(ae.a)(e.imgs.slice(t.imgIndex+1)))});case ce:var a=[];return e.imgs.forEach(function(e,n){if(a.push(e),n===t.index){var i=0===t.likeType?(e.likes||0)-1:(e.likes||0)+1;a[n].likes=i}}),Object(I.a)({},e,{imgs:a});default:return e}},articlesReducer:function(e,t){switch(e=e||{articles:[],curArticle:null,tags:[]},t.type){case se:return 1<t.pageNum?Object(I.a)({},e,{articles:Object(ae.a)(e.articles).concat(Object(ae.a)(t.articles))}):Object(I.a)({},e,{articles:t.articles});case oe:return Object(I.a)({},e,{articles:Object(ae.a)(e.articles.slice(0,t.articleIndex)).concat(Object(ae.a)(e.articles.slice(t.articleIndex+1)))});case le:var a=t.article;return Object(I.a)({},e,{curArticle:a});case ue:return Object(I.a)({},e,{tags:t.tags});case me:return Object(I.a)({},e,{tags:[t.tag].concat(Object(ae.a)(e.tags))});case pe:return Object(I.a)({},e,{tags:Object(ae.a)(e.tags.slice(0,t.tagIndex)).concat(Object(ae.a)(e.tags.slice(t.tagIndex+1)))});default:return e}},commonReducer:function(e,t){switch(e=e||{likes:[],changeMusic:"/about"===window.location.pathname,curNav:"",isLogined:Boolean(window.sessionStorage.getItem("user")),isAdmin:"1"===window.sessionStorage.getItem("type")},t.type){case C:return Object(I.a)({},e,{curNav:t.nav});case x:return Object(I.a)({},e,{isLogined:t.isLogined});case w:return console.log("isAdmin",t.isAdmin),Object(I.a)({},e,{isAdmin:t.isAdmin});case S:return Object(I.a)({},e,{changeMusic:t.changeMusic});case A:return Object(I.a)({},e,{likes:t.likes});default:return e}}}),de=(a(357),a(358),a(470)),ge=a(684),fe=a(1),ve=a.n(fe),be=a(15),Ee=["rgba(106,10,171,.3)","rgba(199,0,125,.3)","rgba(52,21,176,.3)","rgba(68,3,111,.3)","rgba(64,19,175,.3)","rgba(166,0,166,.3)","rgba(108,0,108,.3)"],ye=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).toImgDetailPage=function(e){a.context.router.history.push("/photograph/detail/".concat(e))},a.toGroupImg=function(e,t){e.stopPropagation(),a.context.router.history.push("/photograph/group/".concat(t))},a.state={imgBoxStyle:{background:Ee[Math.floor(Math.random()*Ee.length)],height:""},showGroupBtn:!1},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.onResizeHandler()}},{key:"componentDidMount",value:function(){this.setState({showGroupBtn:-1===this.context.router.history.location.pathname.indexOf("group")}),this.onResizeHandler(),window.onresize=this.resizeThrottle(this.onResizeHandler.bind(this),500,!0)}},{key:"onResizeHandler",value:function(){var e=this.refs.imgBox.clientWidth*(this.props.img.h/this.props.img.w);this.refs.imgBox.style.height=e+"px"}},{key:"resizeThrottle",value:function(e,t,a){var n=null;return function(){var i=this,r=arguments;a&&(e.apply(this,r),a=!1),n=n||setTimeout(function(){console.log("timer is null"),e.apply(i,r),n=null},t)}}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"img-wraper",onClick:this.toImgDetailPage.bind(this,this.props.img._id)},s.a.createElement("div",{className:"img-box",ref:"imgBox",style:this.state.imgBoxStyle},s.a.createElement("img",{src:this.props.img.src,alt:""})),s.a.createElement("div",{className:"img-cover"},s.a.createElement("div",{className:"operate-box"},s.a.createElement("div",null,s.a.createElement(be.a,{className:"heart-icon",type:"heart",onClick:function(t){return e.props.addImgFavor(t,e.props.img._id,e.props.index)}}),s.a.createElement("span",{className:"count-span"},this.props.img.likes||0),this.state.showGroupBtn&&s.a.createElement(be.a,{type:"switcher",className:"collection-icon",onClick:function(t){e.toGroupImg(t,e.props.img.group_id)}}),this.props.isAdmin&&s.a.createElement(be.a,{type:"delete",className:"collection-icon",onClick:function(t){e.props.onDeleteImg(t,e.props.img,e.props.index)}}))),s.a.createElement("div",{className:"info-box"},this.props.img.title)))}}]),t}(c.Component);ye.contextTypes={router:ve.a.object.isRequired};var je=a(208),Ne=a.n(je),ke=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",null,0<this.props.imgs.length&&s.a.createElement(Ne.a,{disableImagesLoaded:!1,updateOnEachImageLoad:!1,options:{transitionDuration:0}},this.props.imgs.map(function(t,a){return s.a.createElement(ye,{img:t,key:a,index:a,addImgFavor:e.props.addImgFavor.bind(e),onDeleteImg:e.props.onDeleteImg.bind(e),isAdmin:e.props.isAdmin})})),0===this.props.imgs.length&&s.a.createElement("div",{style:{textAlign:"center"}},"\u6682\u65e0\u6570\u636e"))}}]),t}(c.Component);ke.defaultProps={imgs:[]};var Oe=a(674),Ie=a(676),Ce=a(201),xe=function(e){function t(){var e,a;Object(p.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(i)))).state={previewVisible:!1,previewImage:"",fileList:[]},a.handleCancel=function(){return a.setState({previewVisible:!1})},a.handlePreview=function(e){a.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})},a.onUploadRemove=function(e){var t=e.uid;a.state.fileList.forEach(function(e,n){if(t===e.uid)return a.state.fileList.splice(n,1),!1}),a.setState({fileList:a.state.fileList}),a.props.getUploadList(a.state.fileList)},a.handleChange=function(e){var t=e.fileList;console.log("change",t)},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"upload",value:function(e){var t=new FormData,a=this;this.getNewImg(e.file,function(n){t.append(e.filename,n),D(t).then(function(e){200===e.data.resCode&&(a.state.fileList.push({name:e.data.fileName,status:"done",url:e.data.url,w:n.w,h:n.h}),a.state.fileList.forEach(function(e,t){e.uid=t}),a.setState({fileList:a.state.fileList}),a.props.getUploadList(a.state.fileList))})})}},{key:"getNewImg",value:function(e,t){var a=new FileReader,n=e.name;a.readAsDataURL(e),a.onload=function(a){var i=a.target.result,r=new Image,c=document.createElement("canvas"),s=c.getContext("2d");r.onload=function(){c.width=.5*this.width,c.height=.5*this.height,s.clearRect(0,0,c.width,c.height),s.drawImage(r,0,0,c.width,c.height);var a=function(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],i=atob(a[1]),r=i.length,c=new Uint8Array(r);r--;)c[r]=i.charCodeAt(r);return new File([c],t,{type:n})}(c.toDataURL("image/jpeg",.92),n);a.w=c.width,a.h=c.height,a.uid=e.uid,t(a)},r.src=i}}},{key:"render",value:function(){var e=this.state,t=e.previewVisible,a=e.previewImage,n=e.fileList,i=s.a.createElement("div",null,s.a.createElement(be.a,{type:"plus"}),s.a.createElement("div",{className:"ant-upload-text"},"Upload"));return s.a.createElement("div",{className:"clearfix"},s.a.createElement(Oe.a,{listType:"picture-card",multiple:!0,fileList:n,customRequest:this.upload.bind(this),onPreview:this.handlePreview,onRemove:this.onUploadRemove,onChange:this.handleChange},3<=n.length?null:i),s.a.createElement(Ie.a,{visible:t,footer:null,onCancel:this.handleCancel},s.a.createElement("img",{alt:"example",style:{width:"100%"},src:a})))}}]),t}(s.a.Component),we=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).handleOk=function(e){a.props.form.validateFields(function(e,t){if(!e){var n={imgs:a.state.imgList,info:a.props.form.getFieldsValue()};(function(e){return Q("".concat(Z,"/api/imgs/publish"),e)})(n).then(function(e){var t=e.data;200===t.resCode&&(a.props.visibleHandler(!1),a.setState({imgList:[]}),a.props.form.resetFields(),t.imglist.forEach(function(e){e.title=n.info.title,a.props.onAddImg(e)}))})}})},a.handleCancel=function(e){a.props.visibleHandler(!1)},a.getUploadList=function(e){a.setState({imgList:e}),console.log("\u63a5\u53d7\u5b50\u7ec4\u4ef6filelist",a.state.imgList)},a.state={imgList:[]},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=["\u5efa\u7b51","\u4eba\u50cf","\u8857\u62cd","\u98ce\u666f","\u5176\u4ed6"],t=this.props.form.getFieldDecorator,a=Ce.a.Option;return s.a.createElement(Ie.a,{width:"40%",title:"\u4e0a\u4f20\u7167\u7247",visible:this.props.visible,onOk:this.handleOk,onCancel:this.handleCancel},s.a.createElement(xe,{getUploadList:this.getUploadList.bind(this)}),s.a.createElement(N.a,{layout:"inline",onSubmit:this.handleOk},s.a.createElement(N.a.Item,{label:"\u7c7b\u522b"},t("category",{initialValue:e[0]})(s.a.createElement(Ce.a,{style:{width:100},onChange:this.handleTypeChange},e.map(function(e,t){return s.a.createElement(a,{key:t,value:e},e)})))),s.a.createElement(N.a.Item,{label:"\u6807\u9898"},t("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7167\u7247\u6807\u9898"}]})(s.a.createElement(k.a,{placeholder:"\u4e3a\u8fd9\u7ec4\u7167\u7247\u8d77\u4e2a\u540d\u5b57\u5427"})))))}}]),t}(c.Component),Se=N.a.create({name:"artile-form"})(we),Ae=a(679),Te=a(678),Re=[{text:"\u6240\u6709\u6587\u7ae0"},{text:"\u7b14\u8bb0",type:0},{text:"\u751f\u6d3b",type:1},{text:"Tags",url:"/articles/tags"},{text:"\u6444\u5f71",url:"/photograph"}],Le=[{text:"\u6240\u6709\u7167\u7247"},{text:"\u5efa\u7b51"},{text:"\u4eba\u50cf"},{text:"\u8857\u62cd"},{text:"\u98ce\u666f"},{text:"\u5176\u4ed6"},{text:"\u535a\u5ba2",url:"/articles"}],_e=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).navClickHandler=function(e,t){if(e.child||e.url)a.props.changeCurNav("");else{var n="";a.setState({activeIndex:t,showMenu:!1}),0!==a.props.type?(n="/articles",void 0!==e.type&&(n+="?type=".concat(e.type)),a.props.handleNavChange&&a.props.handleNavChange(e.type)):(n="/photograph",n+="?type=".concat(e.text),a.props.handleNavChange&&a.props.handleNavChange(e.text)),a.context.router.history.push(n),a.props.changeCurNav&&a.props.changeCurNav(a.state.navArr[t].text)}},a.state={activeIndex:0,navArr:0===a.props.type?Le:Re,showMenu:!1,isLargeScreen:!0,loginText:"\u9000\u51fa"},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.documentElement.clientWidth<=960&&this.setState({isLargeScreen:!1}),"/about"===this.context.router.route.location.pathname?this.setState({activeIndex:this.state.navArr.length}):this.state.navArr.forEach(function(t,a){t.text!==e.props.formParentNav&&t.text!==e.props.curNav||e.setState({activeIndex:a})})}},{key:"clickAbout",value:function(){this.setState({activeIndex:this.state.navArr.length,showMenu:!1}),this.context.router.history.push("/about")}},{key:"toggleMenu",value:function(){this.setState({showMenu:!this.state.showMenu})}},{key:"quitHandle",value:function(){var e=this;K("".concat(Z,"/api/user/quit")).then(function(t){t&&(e.setState({isLogined:!1}),window.sessionStorage.removeItem("user"),window.sessionStorage.removeItem("type"),e.props.changeLoginStatus(!1),e.props.changeUserType(!1),e.context.router.history.push("/"))})}},{key:"loginHandle",value:function(e){Object(j.toast)(s.a.createElement(L,{type:e}),{autoClose:!1,closeOnClick:!1,draggable:!1}),this.setState({showMenu:!1})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("div",{className:"page-header"},(this.state.isLargeScreen||this.state.showMenu)&&s.a.createElement("ul",{className:"img-nav-ul"},s.a.createElement("li",null,s.a.createElement(v.a,{to:"/"},s.a.createElement(be.a,{type:"home",className:"index-btn"}))),this.state.navArr.map(function(t,a){var n="";if(t.child){var i=s.a.createElement(Ae.a,null,t.child.map(function(e,t){return s.a.createElement(Ae.a.Item,{key:t},s.a.createElement("span",null,e))}));n=s.a.createElement(Te.a,{overlay:i,trigger:["click"]},s.a.createElement("span",{onClick:e.navClickHandler.bind(e,t.child,a)},t.text,s.a.createElement(be.a,{type:"down"})))}else n=t.url?s.a.createElement(v.a,{to:t.url},t.text):s.a.createElement("span",null,t.text);return s.a.createElement("li",{key:a,onClick:e.navClickHandler.bind(e,t,a),className:a===e.state.activeIndex?"active":""},n)}),s.a.createElement("li",{onClick:this.clickAbout.bind(this),className:this.state.navArr.length===this.state.activeIndex?"active":""},"\u5173\u4e8e"),s.a.createElement("li",{className:"to-index-link"},this.props.isLogined&&s.a.createElement("span",{className:"op-btn",onClick:this.quitHandle.bind(this)},"\u9000\u51fa"),!this.props.isLogined&&s.a.createElement("span",null,s.a.createElement("span",{className:"op-btn",onClick:this.loginHandle.bind(this,1)},"\u767b\u5f55 "),s.a.createElement("span",{className:"op-btn",onClick:this.loginHandle.bind(this,0)},"\u6ce8\u518c")))),!this.state.showMenu&&s.a.createElement("div",null,s.a.createElement(v.a,{to:"/"},s.a.createElement(be.a,{type:"home",className:"index-btn-1"})),s.a.createElement("span",{className:"current-nav"},this.props.curNav)),s.a.createElement("div",{className:"menu-icon",onClick:this.toggleMenu.bind(this)},!this.state.showMenu&&s.a.createElement("span",null,s.a.createElement(be.a,{type:"bars"})),this.state.showMenu&&s.a.createElement(be.a,{type:"close"}))),this.state.showMenu&&s.a.createElement("div",{className:"nav-mask",onClick:this.toggleMenu.bind(this)}))}}]),t}(c.Component);function Me(e){var t=e.comments,a=t.length;return 1<a?a+=t.reduce(function(e,t){return(e.child?e.child.length:0)+(t.child?t.child.length:0)},0):t[0].child&&(a+=t[0].child.length),s.a.createElement(Be.a,{dataSource:t,header:"".concat(a," \u6761\u8bc4\u8bba"),itemLayout:"horizontal",renderItem:function(e){return s.a.createElement(Ve.a,e,e.child&&e.child.length&&s.a.createElement(Be.a,{dataSource:e.child,itemLayout:"horizontal",renderItem:function(e){return s.a.createElement(Ve.a,e)}}))}})}_e.contextTypes={router:ve.a.object.isRequired};var De=Object(m.b)(function(e){return{curNav:e.commonReducer.curNav,isLogined:e.commonReducer.isLogined,isAdmin:e.commonReducer.isAdmin}},function(e){return{changeCurNav:function(t){e(n(t))},changeLoginStatus:function(t){e(i(t))},changeUserType:function(t){e(r(t))}}})(_e),He=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"handleClick",value:function(){this.props.loadMore()}},{key:"render",value:function(){var e=this.props.show?"\u6b63\u5728\u52a0\u8f7d":"\u52a0\u8f7d\u66f4\u591a";return s.a.createElement("div",{className:"loading-wrap"},this.props.show&&s.a.createElement(de.a,{size:"small"}),s.a.createElement("span",{onClick:this.handleClick.bind(this)},e," "))}}]),t}(c.Component),Fe=(a(200),function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).visibleHandler=function(e){a.setState({dialogVisible:e})},a.state={dialogVisible:!1,loading:!1,showLoading:!1,pageNum:1,pageSize:10,noMore:!0},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){!this.props.curNav||0<=["\u6240\u6709\u7167\u7247","\u6240\u6709\u6587\u7ae0","\u7b14\u8bb0","\u751f\u6d3b","Tags"].indexOf(this.props.curNav)?(this.props.changeCurNav("\u6240\u6709\u7167\u7247"),this.loadImgs()):this.loadImgs(this.props.curNav)}},{key:"loadImgs",value:function(e){var t=this,a=0<arguments.length&&void 0!==e?e:"",n={pageNum:this.state.pageNum,category:a,pageSize:this.state.pageSize};return 1===n.pageNum?(this.setState({loading:!0}),this.props.initImgs([],this.state.pageNum)):this.setState({showLoading:!0}),function(e){return K("".concat(Z,"/api/imgs"),e)}(n).then(function(e){var a=e.data;a?(t.props.initImgs(a.imgs,t.state.pageNum),t.setState({showLoading:!1,loading:!1}),a.allCount<=n.pageNum*n.pageSize?t.setState({noMore:!0}):t.setState({noMore:!1})):t.setState({showLoading:!1,loading:!1,noMore:!0})})}},{key:"loadMore",value:function(){this.setState({pageNum:this.state.pageNum+1},function(){this.loadImgs()})}},{key:"handleDeleteImg",value:function(e,t,a){var n=this,i=t.src,r=t._id,c=t.group_id,s=(i=i.split("/"))[i.length-1];e.stopPropagation(),H({_id:r,imgName:s,group_id:c}).then(function(e){e.data&&n.props.deleteImg(a)})}},{key:"handleAddImgFavor",value:function(e,t,a){var n=this;e.stopPropagation(),F(t).then(function(e){var t=e.data;t&&n.props.addImgFavorCount(a,t.type)})}},{key:"handleNavChange",value:function(e){var t=this;this.setState({pageNum:1},function(){e="\u6240\u6709\u7167\u7247"===e?"":e,t.loadImgs(e)})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(De,{type:0,handleNavChange:this.handleNavChange.bind(this)}),s.a.createElement("div",{className:"container img-container"},this.props.isAdmin&&s.a.createElement(O.a,{type:"primary",className:"common-btn",onClick:this.visibleHandler.bind(this,!0)},"\u4e0a\u4f20\u7167\u7247"),s.a.createElement(Se,{visible:this.state.dialogVisible,visibleHandler:this.visibleHandler,onAddImg:this.props.addImg}),s.a.createElement(de.a,{spinning:this.state.loading},s.a.createElement(ke,{imgs:this.props.imgs,addImgFavor:this.handleAddImgFavor.bind(this),onDeleteImg:this.handleDeleteImg.bind(this),isAdmin:this.props.isAdmin})),!this.state.noMore&&s.a.createElement(He,{show:this.state.showLoading,loadMore:this.loadMore.bind(this)})),s.a.createElement(ge.a,{target:function(){return document.getElementsByClassName("container")[0]}}))}}]),t}(c.Component)),Ue=Object(m.b)(function(e){return{imgs:e.imgsReducer.imgs,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin,likes:e.commonReducer.likes}},function(e){return{initImgs:function(t,a){e(V(t,a))},deleteImg:function(t){e(q(t))},addImg:function(t){e(z(t))},changeCurNav:function(t){e(n(t))},addImgFavorCount:function(t,a){e(G(t,a))}}})(Fe),Pe=a(680),Be=a(675),Ve=a(669),ze=a(670),qe=k.a.TextArea,Ge=function(e){function t(){var e,a;Object(p.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(d.a)(this,(e=Object(g.a)(t)).call.apply(e,[this].concat(i)))).state={submitting:!1,value:"",comments:[],placeholder:"\u8f93\u5165\u8bc4\u8bba\u5185\u5bb9...",receiver:null,textArea:null,belongId:""},a.handleSubmit=function(){if(a.state.value){a.setState({submitting:!0});var e={type:a.props.type,receiver:a.state.receiver||a.props.receiver,content:a.state.value,belongId:a.state.belongId};a.props.onSubmit(e,function(t){if(t.data&&t.data.comment){var n=t.data.comment,i={author:n.sender===a.props.receiver?"\u4f5c\u8005":window.sessionStorage.getItem("user"),avatar:n.avatar||"",content:a.state.value,created_at:n.created_at};e.belongId?(a.state.comments.forEach(function(t){if(t._id+""===e.belongId)return i.author+="\u56de\u590d@\u4f5c\u8005",t.child=[i].concat(Object(ae.a)(t.child)),!1}),a.setState({submitting:!1,value:"",comments:a.state.comments})):a.setState({submitting:!1,value:"",comments:[i].concat(Object(ae.a)(a.state.comments))})}else a.setState({submitting:!1})})}},a.handleChange=function(e){a.setState({value:e.target.value})},a.handleBlur=function(){a.state.value||a.setState({placeholder:"\u8f93\u5165\u8bc4\u8bba\u5185\u5bb9...",receiver:null,belongId:""})},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({comments:e.comments})}},{key:"replay",value:function(e,t,a){this.props.receiver===t&&(a="\u4f5c\u8005"),this.setState({placeholder:"\u56de\u590d".concat(a," :"),receiver:t,belongId:e}),this.textArea.focus()}},{key:"queryReceiverName",value:function(e){var t="";return this.state.comments.forEach(function(a){if(a._id===e)return t=a.senderInfo,!1}),t}},{key:"configComment",value:function(e){var t,a="";if(e.user&&e.user.avatar&&(a=e.user.avatar),e.avatar&&(a=e.avatar),t={avatar:a,content:s.a.createElement("p",null,e.content),datetime:e.created_at,child:e.child},e.isReceiver&&(t.actions=[s.a.createElement("span",{onClick:this.replay.bind(this,e.belongId||e._id,e.sender,e.author||e.senderInfo)},"\u56de\u590d")]),e.sender===this.props.receiver?t.author="\u4f5c\u8005":t.author=e.author||e.senderInfo,e.belongId){var n=this.queryReceiverName(e.belongId);n===t.author&&(n="\u4f5c\u8005"),t.author+="\u56de\u590d@".concat(n)}return t}},{key:"render",value:function(){var e=this,t=this.state,a=t.submitting,n=t.value,i=t.placeholder,r=this.state.comments.map(function(t){var a=e.configComment(t);return t.child&&(a.child=t.child.map(function(t){return e.configComment(t)})),a});return s.a.createElement("div",null,0<r.length&&s.a.createElement(Me,{comments:r}),s.a.createElement(Ve.a,{avatar:s.a.createElement(ze.a,{src:"",alt:""}),content:s.a.createElement("div",null,s.a.createElement(N.a.Item,null,s.a.createElement(qe,{placeholder:i,ref:function(t){return e.textArea=t},rows:4,onBlur:this.handleBlur,onChange:this.handleChange,value:n})),s.a.createElement(N.a.Item,null,s.a.createElement(O.a,{className:"common-btn",htmlType:"submit",loading:a,onClick:this.handleSubmit,type:"primary"},"\u8bc4\u8bba")))}))}}]),t}(c.Component),We=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).resizeImgHandler=function(){a.setState({imgEnlargeble:!a.state.imgEnlargeble})},a.handleSubmit=function(e,t){P(a.state.id,e).then(function(e){e&&t&&t(e)})},a.lastOrNextImg=function(e){a.getImgDetail(a.state.id,e)},a.toGroupImg=function(e){a.context.router.history.push("/photograph/group/".concat(e))},a.state={loading:!1,id:a.props.match.params.id,imgEnlargeble:!1,comments:[],img:{},curPage:0,clickTypeNum:0},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){this.getImgDetail(this.state.id)}},{key:"getImgDetail",value:function(e,t){var a=this;this.setState({loading:!0}),function(e,t){return K("".concat(Z,"/api/imgs/").concat(e),{typeNum:t})}(e,t).then(function(e){var n=e.data;n&&(n.noMore?(Pe.a.warning("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u5f20\u4e86",1),a.setState({clickTypeNum:t})):(a.setState({img:n.img[0],id:n.img[0]._id,clickTypeNum:0,comments:n.comment}),a.context.router.history.push("/photograph/detail/".concat(n.img[0]._id)),a.handleBrowser()),a.setState({loading:!1}))})}},{key:"handleBrowser",value:function(){var e=this;setTimeout(function(){var t;(t=e.state.id,K("".concat(Z,"/api/imgs/").concat(t,"/addImgPv"),{num:void 0})).then(function(t){if(t.data){var a=Object.assign(e.state.img,{pv:(e.state.img.pv||0)+1});e.setState({img:a})}})},2e3)}},{key:"clickImgFavorHandler",value:function(){var e=this;F(this.state.id).then(function(t){var a=t.data;if(a){var n=0===a.type?(e.state.img.likes||0)-1:(e.state.img.likes||0)+1,i=Object.assign(e.state.img,{likes:n});e.setState({img:i})}})}},{key:"goBack",value:function(){this.context.router.history.push("/photograph")}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"img-detail-page"},s.a.createElement(de.a,{spinning:this.state.loading},s.a.createElement("div",{className:["img-switch-wraper",this.state.imgEnlargeble?"active":""].join(" ")},s.a.createElement("div",{className:"center-box"},!this.state.imgEnlargeble&&s.a.createElement(be.a,{type:"close",className:"icon close-icon",onClick:this.goBack.bind(this)}),s.a.createElement(be.a,{type:"left",className:"icon left-icon",onClick:this.lastOrNextImg.bind(this,-1)}),s.a.createElement("img",{src:this.state.img.src,alt:""}),s.a.createElement(be.a,{type:this.state.imgEnlargeble?"shrink":"arrows-alt",className:"icon size-icon",onClick:this.resizeImgHandler.bind(this)}),s.a.createElement(be.a,{type:"right",className:"icon right-icon",onClick:this.lastOrNextImg.bind(this,1)}))),s.a.createElement("div",{className:"detail-box"},s.a.createElement("div",{className:"operate-box"},s.a.createElement("div",null,s.a.createElement(be.a,{className:"icon heart-icon",type:"heart",onClick:this.clickImgFavorHandler.bind(this)}),s.a.createElement("span",{className:"count-span"},this.state.img.likes||0),s.a.createElement(be.a,{className:"icon",type:"eye"}),s.a.createElement("span",{className:"count-span"},this.state.img.pv||0),s.a.createElement(be.a,{type:"switcher",className:"icon collection-icon",onClick:function(t){e.toGroupImg(e.state.img.groupId)}}))),s.a.createElement("div",{className:"comment-wrap"},s.a.createElement(Ge,{type:1,receiver:this.state.img.author,comments:this.state.comments,onSubmit:this.handleSubmit.bind(this)})))))}}]),t}(c.Component);We.contextTypes={router:ve.a.object.isRequired};var Je=Object(m.b)(function(e){return{imgs:e.imgs,curImg:e.curImg}},function(e){return{}})(We),Ye=["3940933","3947469","428350031","448917907","19466001","29729012","16649839","1651735","21469678","410925920","425684928","466333783","400690256","19535983","4405800","3947469","4111185","18861490","462516170","417833085"],Ke=function(e){function t(){return Object(p.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"music-wrap "+(this.props.changeMusic?"show":"hide")},s.a.createElement("iframe",{id:"musicFrame",title:"music",frameBorder:"no",border:"0",marginWidth:"0",marginHeight:"0",width:"200",height:"86",src:"//music.163.com/outchain/player?type=2&id=".concat(Ye[Math.floor(Math.random()*Ye.length)],"&auto=1&height=66")}))}}]),t}(c.Component),Qe=Object(m.b)(function(e){return{changeMusic:e.commonReducer.changeMusic}})(Ke),Xe=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={loading:!1,groupId:a.props.match.params.id,groupInfo:{}},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){this.loadImgs(),this.props.curNav||this.props.changeCurNav("\u6240\u6709\u7167\u7247")}},{key:"loadImgs",value:function(){var e,t=this;return this.setState({loading:!0}),this.props.initImgs([],1),(e=this.state.groupId,K("".concat(Z,"/api/groupImgs"),{groupId:e})).then(function(e){var a=e.data;a&&(t.setState({groupInfo:a.group.info}),t.props.initImgs(a.group.imgs,1)),t.setState({loading:!1})})}},{key:"handleDeleteImg",value:function(e,t,a){var n=this,i=t.src,r=t._id,c=t.group_id,s=(i=i.split("/"))[i.length-1];e.stopPropagation(),H({_id:r,imgName:s,group_id:c}).then(function(e){e.data&&n.props.deleteImg(a)})}},{key:"handleAddImgFavor",value:function(e,t,a){var n=this;e.stopPropagation(),F(t).then(function(e){e.data&&n.props.addImgFavorCount(a)})}},{key:"handleNavChange",value:function(e){this.setState({pageNum:1}),e="\u6240\u6709\u7167\u7247"===e?"":e,this.loadImgs(e)}},{key:"goBack",value:function(){this.context.router.history.push("/photograph")}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(De,{type:0,handleNavChange:this.handleNavChange.bind(this)}),s.a.createElement(Qe,null),s.a.createElement("div",{className:"container img-container"},s.a.createElement(de.a,{spinning:this.state.loading},s.a.createElement("div",{className:"group-info"},s.a.createElement("p",{className:"title"},this.state.groupInfo.title),s.a.createElement("ul",{className:"tag-list"},s.a.createElement("li",null,this.state.groupInfo.category)),s.a.createElement("p",{className:"date"},this.state.groupInfo.created_at)),s.a.createElement(ke,{imgs:this.props.imgs,addImgFavor:this.handleAddImgFavor.bind(this),onDeleteImg:this.handleDeleteImg.bind(this),isAdmin:this.props.isAdmin}),s.a.createElement("div",{className:"group-info"},s.a.createElement(O.a,{onClick:this.goBack.bind(this)},"\u8fd4 \u56de")))))}}]),t}(c.Component);Xe.contextTypes={router:ve.a.object.isRequired};var Ze=Object(m.b)(function(e){return{imgs:e.imgsReducer.imgs,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initImgs:function(t,a){e(V(t,a))},deleteImg:function(t){e(q(t))},addImg:function(t){e(z(t))},changeCurNav:function(t){e(n(t))},addImgFavorCount:function(t){e(G(t))}}})(Xe),$e=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this.props.article;return s.a.createElement("div",{className:"article-wraper"},s.a.createElement("div",{className:["cover-box",e.cover_url?"":"no-cover"].join(" ")},s.a.createElement("img",{"v-if":e.cover_url,src:e.cover_url,alt:""})),s.a.createElement("div",{className:"info"},s.a.createElement("h3",{className:"title"},s.a.createElement("p",{onClick:this.props.viewDetail.bind(this,e._id)},e.title),this.props.isAdmin&&s.a.createElement("span",{className:"operate-btn"},s.a.createElement(be.a,{type:"delete",onClick:this.props.deleteArticle.bind(this,e._id,this.props.index,e.cover_url)}),s.a.createElement(be.a,{type:"edit",onClick:this.props.editArticle.bind(this,e._id)}))),s.a.createElement("p",{className:"time"},e.created_at,s.a.createElement("span",null,s.a.createElement(be.a,{type:"message",className:"icon"}),e.comments||0),s.a.createElement("span",null,s.a.createElement(be.a,{type:"fire",className:"icon"}),e.pv||0)),s.a.createElement("div",{className:"description"},e.description)))}}]),t}(c.Component);$e.contextTypes={router:ve.a.object.isRequired};var et=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",null,0<this.props.articles.length&&s.a.createElement("div",null,this.props.articles.map(function(t,a){return s.a.createElement($e,{article:t,key:t._id,index:a,deleteArticle:e.props.deleteArticle.bind(e),editArticle:e.props.editArticle.bind(e),viewDetail:e.props.viewDetail.bind(e),isAdmin:e.props.isAdmin})})),0===this.props.articles.length&&s.a.createElement("div",{style:{textAlign:"center"}},"\u6682\u65e0\u6570\u636e"))}}]),t}(c.Component);et.defaultProps={articles:[]},a(146);var tt=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).onEditArticle=function(e){a.context.router.history.push("/articles/edit/".concat(e))},a.onViewDetail=function(e){a.context.router.history.push("/articles/detail/".concat(e))},a.state={loading:!1,showLoading:!1,pageNum:1,pageSize:10,noMore:!0},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){var e=this.context.router.route.location.search,t=e.substring(e.length-1),a=this.props.match.params.tag;if(t){this.loadArticles(t);var n="0"===t?"\u7b14\u8bb0":"\u751f\u6d3b";this.props.changeCurNav(n)}else a?this.props.getArticlesByTagName(a):this.loadArticles(),this.props.curNav||this.props.changeCurNav("\u6240\u6709\u6587\u7ae0")}},{key:"loadArticles",value:function(e){var t=this,a=0<arguments.length&&void 0!==e?e:"",n={pageNum:this.state.pageNum,pageSize:this.state.pageSize,type:a};1===n.pageNum?(this.setState({loading:!0}),this.props.initArticles([],this.state.pageNum)):this.setState({showLoading:!0}),function(e){return K("".concat(Z,"/api/articles"),e)}(n).then(function(e){var a=e.data;a?(t.props.initArticles(a.articles,t.state.pageNum),t.setState({showLoading:!1,loading:!1}),a.allCount<=n.pageNum*n.pageSize?t.setState({noMore:!0}):t.setState({noMore:!1})):t.setState({showLoading:!1,loading:!1,noMore:!0})})}},{key:"loadMore",value:function(){this.setState({pageNum:this.state.pageNum+1},function(){this.loadArticles()})}},{key:"handleNavChange",value:function(e){var t=this;this.setState({pageNum:1},function(){t.loadArticles(e)})}},{key:"onDeleteArticle",value:function(e,t,a){var n=this,i="";a&&(i=(a=a.split("/"))[a.length-1]),function(e){return K("".concat(Z,"/api/articles/").concat(e.articleId,"/remove"),{coverName:e.coverName})}({articleId:e,coverName:i}).then(function(e){e.data&&n.props.deleteArticle(t)})}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(De,{type:1,formParentNav:"\u6240\u6709\u6587\u7ae0",handleNavChange:this.handleNavChange.bind(this)}),s.a.createElement("div",{className:"container article-container"},this.props.isAdmin&&s.a.createElement(v.a,{to:"/articles/new"},"\u5199\u6587\u7ae0"),s.a.createElement(de.a,{spinning:this.state.loading},s.a.createElement("div",null,s.a.createElement(et,{articles:this.props.articles,deleteArticle:this.onDeleteArticle.bind(this),editArticle:this.onEditArticle.bind(this),viewDetail:this.onViewDetail.bind(this),isAdmin:this.props.isAdmin}),!this.state.noMore&&s.a.createElement(He,{show:this.state.showLoading,loadMore:this.loadMore.bind(this)}))),s.a.createElement(ge.a,{target:function(){return document.getElementsByClassName("container")[0]}})))}}]),t}(c.Component);tt.contextTypes={router:ve.a.object.isRequired};var at=Object(m.b)(function(e){return{articles:e.articlesReducer.articles,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initArticles:function(t,a){e(W(t,a))},getArticlesByTagName:function(t){(function(e){return K("".concat(Z,"/api/tag/articles"),{tag:e})})(t).then(function(t){var a=t.data;a&&e(W(a.articles))})},deleteArticle:function(t){e(function(e){return{type:oe,articleIndex:e}}(t))},changeCurNav:function(t){e(n(t))}}})(tt),nt=a(213),it=a.n(nt),rt=(a(661),function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).lastOrNextArticle=function(e){a.articleDetail(a.state.id,e)},a.handleSubmit=function(e,t){P(a.state.id,e).then(function(e){e&&t&&t(e)})},a.backListPage=function(){a.props.changeCurNav("")},a.state={loading:!1,id:a.props.match.params.id,comments:[],article:{},curPage:0,clickTypeNum:0,tags:[]},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"handleBrowser",value:function(){var e=this;setTimeout(function(){var t;(t=e.state.id,K("".concat(Z,"/api/articles/").concat(t,"/addArticlePv"))).then(function(t){if(t.data){var a=Object.assign(e.state.article,{pv:(e.state.article.pv||0)+1});e.setState({article:a})}})},2e3)}},{key:"componentWillMount",value:function(){this.articleDetail(this.state.id),this.props.changeCurNav("\u6587\u7ae0\u8be6\u60c5")}},{key:"articleDetail",value:function(e,t){var a=this,n=1<arguments.length&&void 0!==t?t:"";this.setState({loading:!0}),U(e,n).then(function(e){var t=e.data;t&&(t.noMore?(Pe.a.warning("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u7bc7\u4e86",1),a.setState({clickTypeNum:n})):(a.setState({article:t.article[0],id:t.article[0]._id,clickTypeNum:0,comments:t.comment,tags:t.tags}),a.context.router.history.push("/articles/detail/".concat(t.article[0]._id)),a.handleBrowser())),a.setState({loading:!1})})}},{key:"clickArticleFavorHandler",value:function(){var e,t=this;console.log("click"),(e=this.state.id,K("".concat(Z,"/api/articles/").concat(e,"/addArticleFavor"))).then(function(e){var a=e.data;if(a){var n=0===a.type?(t.state.article.likes||0)-1:(t.state.article.likes||0)+1,i=Object.assign(t.state.article,{likes:n});t.setState({article:i})}})}},{key:"render",value:function(){var e;return this.state.article.created_at&&(e=this.state.article.created_at.replace(/-/g,".")),s.a.createElement("div",null,s.a.createElement(De,{type:1}),s.a.createElement("div",{className:"container article-detail-container"},s.a.createElement(de.a,{spinning:this.state.loading},s.a.createElement("div",{className:"left"},s.a.createElement(v.a,{to:"/articles",onClick:this.backListPage.bind(this)},s.a.createElement(be.a,{type:"left",className:"back-btn"})),s.a.createElement("div",{className:"top-info-box"},s.a.createElement("h2",null,this.state.article.title),s.a.createElement("div",{className:"top-bottom"},s.a.createElement("span",null,e," Beijing"),s.a.createElement("span",{className:"browse-num"},s.a.createElement(be.a,{type:"fire",className:"fire-icon"}),this.state.article.pv||0),s.a.createElement("span",{className:"browse-num like-num",onClick:this.clickArticleFavorHandler.bind(this)},s.a.createElement(be.a,{type:"heart",className:"fire-icon"}),this.state.article.likes||0))),s.a.createElement("div",{className:"left-bottom-box"},s.a.createElement("ul",{className:"tag-list"},this.state.tags&&this.state.tags.map(function(e){return s.a.createElement("li",{key:e._id},e.name)})),this.state.article.description),s.a.createElement("div",{className:"control-box"},s.a.createElement("span",{onClick:this.lastOrNextArticle.bind(this,-1)},"\u4e0a\u4e00\u7bc7"),s.a.createElement("span",{onClick:this.lastOrNextArticle.bind(this,1)},"\u4e0b\u4e00\u7bc7"))),s.a.createElement("div",{className:"right"},s.a.createElement(it.a,{className:"language-name-of-snippet",innerHTML:!0},this.state.article.content),s.a.createElement(Ge,{type:0,receiver:this.state.article.author,comments:this.state.comments,onSubmit:this.handleSubmit.bind(this)})))))}}]),t}(c.Component));rt.contextTypes={router:ve.a.object.isRequired};var ct=Object(m.b)(function(e){return{curArticle:e.articlesReducer.curArticle,articles:e.articlesReducer.articles}},function(e){return{changeCurNav:function(t){e(n(t))}}})(rt),st=a(671),ot=a(672),lt=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||console.log("Received values of form: ",t)})},a.getFormData=function(){var e;return a.props.form.validateFields(function(t,n){t||(console.log("Received values of form: ",n),e=Object.assign({tags:a.state.selectedTags,coverName:a.state.coverName,coverUrl:a.state.coverUrl},a.props.form.getFieldsValue()))}),e},a.state={selectedTags:[],loading:!1,coverUrl:"",coverName:""},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.props.onRef(this),this.props.form.setFieldsValue({type:0})}},{key:"componentWillReceiveProps",value:function(e){e.article&&!this.props.article&&this.initForm(e.article)}},{key:"initForm",value:function(e){var t={type:e.type,title:e.title,description:e.description};this.setState({coverUrl:e.cover_url,selectedTags:e.tags.map(function(e){return e.name})}),this.props.form.setFieldsValue(t)}},{key:"handleTagChange",value:function(e){this.setState({selectedTags:e})}},{key:"onUploadCover",value:function(e){var t=this;this.setState({loading:!0}),this.props.uploadCover(e,function(e){200===e.data.resCode&&t.setState({coverUrl:e.data.url,loading:!1,coverName:e.data.fileName})})}},{key:"render",value:function(){var e=s.a.createElement("div",null,s.a.createElement(be.a,{type:this.state.loading?"loading":"plus"}),s.a.createElement("div",{className:"ant-upload-text"},"\u6587\u7ae0\u5c01\u9762")),t=Ce.a.Option,a=this.props.form.getFieldDecorator,n=[];if(this.props.allTags)for(var i=0;i<this.props.allTags.length;i++)n.push(s.a.createElement(t,{key:this.props.allTags[i].name,value:this.props.allTags[i].name},this.props.allTags[i].name));return s.a.createElement(N.a,{onSubmit:this.handleSubmit,className:"artile-form"},s.a.createElement(st.a,null,s.a.createElement(ot.a,{span:4},s.a.createElement(N.a.Item,null,a("type")(s.a.createElement(Ce.a,{style:{width:100}},s.a.createElement(t,{value:0},"\u7b14\u8bb0"),s.a.createElement(t,{value:1},"\u751f\u6d3b"))))),s.a.createElement(ot.a,{span:20},s.a.createElement(N.a.Item,null,a("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u7ae0\u6807\u9898"}]})(s.a.createElement(k.a,{placeholder:"\u6587\u7ae0\u6807\u9898"}))))),s.a.createElement(N.a.Item,null,a("description",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u7ae0\u63cf\u8ff0"}]})(s.a.createElement(k.a,{placeholder:"\u63cf\u8ff0\u4e0b\u6587\u7ae0\u5427"}))),s.a.createElement(N.a.Item,null,s.a.createElement(st.a,null,s.a.createElement(ot.a,{span:18},s.a.createElement(Ce.a,{mode:"tags",placeholder:"\u9009\u62e9\u6807\u7b7e",value:this.state.selectedTags,onChange:this.handleTagChange.bind(this),style:{width:"100%"}},n)),s.a.createElement(ot.a,{span:2}),s.a.createElement(ot.a,{span:2},s.a.createElement(Oe.a,{listType:"picture-card",className:"cover-uploader",customRequest:this.onUploadCover.bind(this),showUploadList:!1},this.state.coverUrl?s.a.createElement("img",{src:this.state.coverUrl,alt:"cover"}):e)))))}}]),t}(s.a.Component),ut=N.a.create({name:"artile-form"})(lt),mt=a(214),pt=a.n(mt),ht=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={editorContent:""},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.onRef(this);var t=this.refs.editorElem;this.editor=new pt.a(t),this.editor.customConfig.uploadImgShowBase64=!0,this.editor.customConfig.onchange=function(t){e.setState({editorContent:t})},this.editor.create()}},{key:"componentWillReceiveProps",value:function(e){e.article&&!this.props.article&&(this.setState({editorContent:e.article.content}),this.editor.txt.html(e.article.content))}},{key:"getContent",value:function(){return{content:this.state.editorContent}}},{key:"render",value:function(){return s.a.createElement("div",{ref:"editorElem",className:"edit-wrapper"})}}]),t}(c.Component),dt=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).onRef=function(e){a.child=e},a.state={articleId:a.props.match.params.id},a}var a;return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:(a=Object(y.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.articleId)return e.next=3,this.props.articleDetail(this.state.articleId);e.next=3;break;case 3:this.props.initTags();case 4:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.props.resetCurArticle()}},{key:"uploadCover",value:function(e,t){var a=new FormData;a.append(e.filename,e.file),D(a).then(function(e){200===e.data.resCode&&t&&t(e)})}},{key:"saveArticleHandler",value:function(){var e=this,t=this.form.getFormData();t&&(t=Object.assign(this.child.getContent(),t),this.state.articleId?function(e,t){return Q("".concat(Z,"/api/articles/").concat(e,"/update"),{article:t})}(this.state.articleId,t).then(function(t){t.data&&e.context.router.history.push("/articles")}):function(e){return Q("".concat(Z,"/api/articles/create"),{article:e})}(t).then(function(t){t.data&&e.context.router.history.push("/articles")}))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(De,{type:1}),s.a.createElement("div",{className:"container edit-container"},s.a.createElement(ut,{wrappedComponentRef:function(t){return e.form=t},article:this.props.curArticle,allTags:this.props.tags,onRef:this.onRef,uploadCover:this.uploadCover}),s.a.createElement(ht,{onRef:this.onRef,article:this.props.curArticle}),s.a.createElement(O.a,{type:"primary",className:"common-btn operate-btn",onClick:this.saveArticleHandler.bind(this)},"\u53d1\u5e03"),s.a.createElement(O.a,{className:"operate-btn"},s.a.createElement(v.a,{to:"/articles"},"\u53d6\u6d88"))))}}]),t}(c.Component);dt.contextTypes={router:ve.a.object.isRequired};var gt=Object(m.b)(function(e){return{curArticle:e.articlesReducer.curArticle,tags:e.articlesReducer.tags}},function(e){return{initTags:function(){B().then(function(t){var a=t.data;a&&e(Y(a.tags))})},articleDetail:function(t,a){return U(t,1<arguments.length&&void 0!==a?a:"").then(function(t){var a=t.data;if(a){var n=Object.assign({tags:a.tags},a.article[0]);e(J(n))}})},resetCurArticle:function(){e(J(null))}}})(dt),ft=a(76),vt=a(683),bt=a(216),Et=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).handleClose=function(t){var n=0;try{a.props.tags.forEach(function(e,a){if(e._id===t._id)return n=a,!1})}catch(e){throw new Error("current deleted tag_id is not exist")}a.props.deleteTag(t._id,n)},a.showInput=function(){a.setState({inputVisible:!0},function(){return a.input.focus()})},a.handleInputChange=function(e){a.setState({inputValue:e.target.value})},a.handleInputConfirm=function(){var e=a.state.inputValue;a.props.addTag(e),a.setState({inputVisible:!1,inputValue:""})},a.saveInputRef=function(e){return a.input=e},a.forMap=function(e){var t=s.a.createElement(vt.a,{closable:!!a.props.isAdmin,onClose:function(t){t.preventDefault(),a.handleClose(e)}},s.a.createElement("span",{onClick:a.clickTagHandler.bind(Object(ft.a)(Object(ft.a)(a)),e.name)},e.name));return s.a.createElement("span",{key:e._id,style:{display:"inline-block"}},t)},a.state={inputVisible:!1,inputValue:""},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"clickTagHandler",value:function(e){this.props.clickTagHandler(e)}},{key:"render",value:function(){var e=this.state,t=e.inputVisible,a=e.inputValue,n=(this.props.tags||[]).map(this.forMap);return s.a.createElement("div",null,s.a.createElement("div",{style:{marginBottom:16}},s.a.createElement(bt.a,{enter:{scale:.8,opacity:0,type:"from",duration:100,onComplete:function(e){e.target.style=""}},leave:{opacity:0,width:0,scale:0,duration:200},appear:!1},n)),t&&s.a.createElement(k.a,{ref:this.saveInputRef,type:"text",size:"small",style:{width:78},value:a,onChange:this.handleInputChange,onBlur:this.handleInputConfirm,onPressEnter:this.handleInputConfirm}),!t&&this.props.isAdmin&&s.a.createElement(vt.a,{onClick:this.showInput,style:{background:"#fff",borderStyle:"dashed"}},s.a.createElement(be.a,{type:"plus"})," New Tag"))}}]),t}(c.Component),yt=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(d.a)(this,Object(g.a)(t).call(this,e))).state={},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.props.initTags(),setTimeout(function(){e.props.changeCurNav("Tags")},0)}},{key:"clickTagHandler",value:function(e){this.context.router.history.push("/articles/tags/".concat(e))}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(De,{type:1,formParentNav:"Tags"}),s.a.createElement("div",{className:"container article-container"},s.a.createElement(Et,{isAdmin:this.props.isAdmin,tags:this.props.tags,initTags:this.props.initTags,addTag:this.props.addTag,deleteTag:this.props.deleteTag,clickTagHandler:this.clickTagHandler.bind(this)})))}}]),t}(c.Component);yt.contextTypes={router:ve.a.object.isRequired};var jt=Object(m.b)(function(e){return{tags:e.articlesReducer.tags,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initTags:function(){B().then(function(t){var a=t.data;a&&e(Y(a.tags))})},deleteTag:function(t,a){(function(e){return K("".concat(Z,"/api/articleTags/").concat(e.tagId,"/remove"))})({tagId:t}).then(function(t){t.data&&e({type:pe,tagIndex:a})})},addTag:function(t){(function(e){return Q("".concat(Z,"/api/articleTags/create"),e)})({name:t}).then(function(t){var a=t.data;a&&e(function(e){return{type:me,tag:e}}(a.res))})},changeCurNav:function(t){e(n(t))}}})(yt),Nt=function(e){function t(){return Object(p.a)(this,t),Object(d.a)(this,Object(g.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentWillMount",value:function(){var e=this;setTimeout(function(){e.props.changeCurNav("\u5173\u4e8e")},0),this.props.changeShowMusic(!0)}},{key:"changeSong",value:function(){var e=this;this.props.changeShowMusic(!1),setTimeout(function(){e.props.changeShowMusic(!0)},0)}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(De,null),s.a.createElement("div",{className:"about-me"},s.a.createElement("img",{className:"avator",alt:"",src:a(663)}),s.a.createElement("div",null,s.a.createElement("p",null,"\u9ebb\u70e6\u8ba9\u6211\u4e00\u591c\u66b4\u5bcc \u5b9e\u5728\u4e0d\u884c\u7684\u8bdd \u534a\u4e2a\u6708\u4e5f\u884c \u4e00\u5e74\u4e5f\u53ef\u4ee5"),s.a.createElement("p",null,s.a.createElement("a",{target:"blank",href:"https://github.com/HuangChuFeng"},s.a.createElement(be.a,{type:"github"})," ",s.a.createElement("span",null,"github")),"\xa0\xa0\xa0\xa0",s.a.createElement("a",{target:"blank",href:"https://weibo.com/5454891945/profile"},s.a.createElement(be.a,{type:"weibo-circle"})," ",s.a.createElement("span",null,"__cranky"))),s.a.createElement("p",{onClick:this.changeSong.bind(this)},s.a.createElement("span",{className:"change-song-btn"},"\u6362\u6b4c")))))}}]),t}(c.Component),kt=Object(m.b)(function(e){return{curNav:e.commonReducer.curNav}},function(e){return{changeShowMusic:function(t){e(function(e){return{type:S,changeMusic:e}}(t))},changeCurNav:function(t){e(n(t))}}})(Nt),Ot=a(682),It=a(681),Ct=(a(664),Object(u.c)(he));console.log("NODE_ENV","production"),l.a.render(s.a.createElement(m.a,{store:Ct},s.a.createElement("div",null,s.a.createElement(Qe,null),s.a.createElement(Ot.a,null,s.a.createElement("div",null,s.a.createElement(It.a,{exact:!0,path:"/",component:te}),s.a.createElement(It.a,{exact:!0,path:"/about",component:kt}),s.a.createElement(It.a,{exact:!0,path:"/photograph",component:Ue}),s.a.createElement(It.a,{exact:!0,path:"/photograph/detail/:id",component:Je}),s.a.createElement(It.a,{exact:!0,path:"/photograph/group/:id",component:Ze}),s.a.createElement(It.a,{exact:!0,path:"/articles",component:at}),s.a.createElement(It.a,{exact:!0,path:"/articles/detail/:id",component:ct}),s.a.createElement(It.a,{exact:!0,path:"/articles/new",component:gt}),s.a.createElement(It.a,{exact:!0,path:"/articles/edit/:id",component:gt}),s.a.createElement(It.a,{exact:!0,path:"/articles/tags",component:jt}),s.a.createElement(It.a,{exact:!0,path:"/articles/tags/:tag",component:at}),s.a.createElement(j.ToastContainer,null))))),document.getElementById("root"))}},[[218,2,1]]]);