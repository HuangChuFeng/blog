(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{148:function(e,t,a){},202:function(e,t,a){},220:function(e,t,a){e.exports=a(664)},335:function(e,t,a){},339:function(e,t,a){var n={"./img1.jpg":340,"./img10.jpg":341,"./img11.jpg":342,"./img12.jpg":343,"./img13.jpg":344,"./img14.jpg":345,"./img15.jpg":346,"./img16.jpg":347,"./img17.jpg":348,"./img2.jpg":349,"./img3.jpg":350,"./img4.jpg":351,"./img5.jpg":352,"./img6.jpg":353,"./img7.jpg":354,"./img8.jpg":355,"./img9.jpg":356};function i(e){var t=r(e);return a(t)}function r(e){var t=n[e];if(!(t+1)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return t}i.keys=function(){return Object.keys(n)},i.resolve=r,e.exports=i,i.id=339},340:function(e,t,a){e.exports=a.p+"static/media/img1.3351d8f8.jpg"},341:function(e,t,a){e.exports=a.p+"static/media/img10.39e739c8.jpg"},342:function(e,t,a){e.exports=a.p+"static/media/img11.e2702cdd.jpg"},343:function(e,t,a){e.exports=a.p+"static/media/img12.88a76fdb.jpg"},344:function(e,t,a){e.exports=a.p+"static/media/img13.366199ec.jpg"},345:function(e,t,a){e.exports=a.p+"static/media/img14.8585d4a4.jpg"},346:function(e,t,a){e.exports=a.p+"static/media/img15.9a5b0b40.jpg"},347:function(e,t,a){e.exports=a.p+"static/media/img16.331a8661.jpg"},348:function(e,t,a){e.exports=a.p+"static/media/img17.8b7b57fc.jpg"},349:function(e,t,a){e.exports=a.p+"static/media/img2.5f0110bf.jpg"},350:function(e,t,a){e.exports=a.p+"static/media/img3.fad77519.jpg"},351:function(e,t,a){e.exports=a.p+"static/media/img4.32cf8853.jpg"},352:function(e,t,a){e.exports=a.p+"static/media/img5.1a6f3ceb.jpg"},353:function(e,t,a){e.exports=a.p+"static/media/img6.dadad061.jpg"},354:function(e,t,a){e.exports=a.p+"static/media/img7.1c35e8bb.jpg"},355:function(e,t,a){e.exports=a.p+"static/media/img8.7f8bb6f5.jpg"},356:function(e,t,a){e.exports=a.p+"static/media/img9.1bcce4d0.jpg"},358:function(e,t,a){},469:function(e,t,a){e.exports=a.p+"static/media/avator.8bf53cd0.jpeg"},664:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(6),c=a.n(r),s=a(66),o=a(25),l=a(9),u=a(10),m=a(13),p=a(11),d=a(12),h=a(677),g=a(665),f=a(45),v=a.n(f),b=a(68),E=a(35),y=a(671),N=a(675),j=a(100),O=a(29),I=function(e){return{type:"CHANGE_CUR_NAV",nav:e}},k=function(e){return{type:"CHANGE_LOGIN_STATUS",isLogined:e}},C=function(e){return{type:"CHANGE_USER_TYPE",isAdmin:e}},x=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||(0===a.props.type?F(t).then(function(e){var t=e.data;t&&(window.localStorage.setItem("type",t.res.type),window.localStorage.setItem("user","\u6765\u81ea".concat(t.res.source,"\u7684").concat(t.res.name)),E.toast.dismiss(),a.props.changeLoginStatus(!0),a.props.changeUserType(1===t.res.type))}):P(t).then(function(e){var t=e.data;t&&(window.localStorage.setItem("type",t.user.type),window.localStorage.setItem("user","\u6765\u81ea".concat(t.user.source,"\u7684").concat(t.user.name)),E.toast.dismiss(),a.props.changeLoginStatus(!0),a.props.changeUserType(1===t.user.type))}))})},a.state={btnText:"\u6ce8\u518c"},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.setState({btnText:0===this.props.type?"\u6ce8 \u518c":"\u767b \u5f55"})}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return i.a.createElement(y.a,{onSubmit:this.handleSubmit,className:"login-form"},0===this.props.type&&i.a.createElement("div",null,i.a.createElement(y.a.Item,{label:"\u4e00\u4e2a\u6765\u81ea"},e("source",{rules:[{required:!0,message:"\u6211\u8981\u77e5\u9053\u4f60\u4ece\u54ea\u91cc\u6765\u554a\u670b\u53cb"}]})(i.a.createElement(N.a,{placeholder:"\u793e\u4ea4\u5e73\u53f0"}))),i.a.createElement(y.a.Item,{label:"\u7684"},e("name",{rules:[{required:!0,message:"\u6211\u8981\u77e5\u9053\u4f60\u7684\u540d\u5b57\u554a\u670b\u53cb"}]})(i.a.createElement(N.a,{placeholder:"\u5c0f\u53ef\u7231"})))),i.a.createElement(y.a.Item,{label:"\u90ae\u7bb1"},e("email",{rules:[{required:!0,message:"\u6211\u8981\u77e5\u9053\u4f60\u7684\u540d\u5b57\u554a\u670b\u53cb"}]})(i.a.createElement(N.a,{placeholder:"\u90ae\u7bb1"}))),i.a.createElement(y.a.Item,{label:"\u5bc6\u7801"},e("password",{rules:[{required:!0,message:"\u6211\u8981\u77e5\u9053\u4f60\u7684\u540d\u5b57\u554a\u670b\u53cb"}]})(i.a.createElement(N.a,{type:"password",placeholder:"\u5bc6\u7801"}))),i.a.createElement(y.a.Item,null,i.a.createElement(j.a,{type:"primary",htmlType:"submit",className:"login-form-button"},this.state.btnText)))}}]),t}(i.a.Component),w=y.a.create({name:"normal_login"})(x),T=Object(o.b)(function(e){return{isLogined:e.commonReducer.isLogined}},function(e){return{changeLoginStatus:function(t){e(k(t))},changeUserType:function(t){e(C(t))}}})(w),A=function(){var e=Object(b.a)(v.a.mark(function e(t){var a,n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"});case 3:return a=e.sent,e.next=6,a.json();case 6:if(500!==(n=e.sent).resCode){e.next=13;break}if(E.toast.error(n.message,{position:E.toast.POSITION.TOP_RIGHT}),401!==n.resCode){e.next=12;break}return console.log("USER_INVALID"),e.abrupt("return");case 12:throw new Error(n.message);case 13:return e.abrupt("return",{data:n});case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return",{code:-2,message:e.t0.message});case 19:case"end":return e.stop()}},e,this,[[0,16]])}));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=Object(b.a)(v.a.mark(function e(t,a){var n,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});case 3:return n=e.sent,e.next=6,n.json();case 6:if(200===(r=e.sent).resCode){e.next=10;break}throw 401===r.resCode?(console.log("USER_INVALID"),Object(E.toast)(i.a.createElement(T,null),{autoClose:!1,closeOnClick:!1,draggable:!1})):E.toast.error(r.message,{position:E.toast.POSITION.TOP_RIGHT}),new Error(r.message);case 10:return e.abrupt("return",{data:r});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",{message:e.t0.message});case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(t,a){return e.apply(this,arguments)}}(),_=function(){var e=Object(b.a)(v.a.mark(function e(t,a){var n,i;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{method:"POST",body:a});case 3:return n=e.sent,e.next=6,n.json();case 6:if(500!==(i=e.sent).resCode){e.next=10;break}throw E.toast.error(i.message,{position:E.toast.POSITION.TOP_RIGHT}),new Error(i.message);case 10:return e.abrupt("return",{data:i});case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",{code:-2,message:"\u672a\u77e5\u9519\u8bef"});case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(t,a){return e.apply(this,arguments)}}(),L="http://www.huangchufeng.site:3000",R=function(e){return S("".concat(L,"/api/imgs/publish"),e)},D=function(e){return _("".concat(L,"/api/uploadImg"),e)},M=function(e){return A("".concat(L,"/api/imgs/").concat(e._id,"/remove?imgName=").concat(e.imgName,"&groupId=").concat(e.group_id))},H=function(e){return A("".concat(L,"/api/imgs/").concat(e,"/addImgFavor"))},P=function(e){return S("".concat(L,"/api/user/login"),e)},F=function(e){return S("".concat(L,"/api/user/register"),e)},U=function(e,t){return A("".concat(L,"/api/articles/").concat(e,"?typeNum=").concat(t))},G=function(e,t){return S("".concat(L,"/api/").concat(e,"/comment"),t)},V=function(e){return A("".concat(L,"/api/articleTags"))},B=["3940933","3947469","428350031","448917907","19466001","29729012","16649839","1651735","21469678","410925920","425684928","466333783","400690256","19535983","4405800","3947469","4111185","18861490","462516170","417833085"],q=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"music-wrap"},i.a.createElement("iframe",{id:"musicFrame",title:"music",frameBorder:"no",border:"0",marginWidth:"0",marginHeight:"0",width:"200",height:"86",src:"//music.163.com/outchain/player?type=2&id=".concat(B[Math.floor(Math.random()*B.length)],"&auto=1&height=66")}))}}]),t}(n.Component),W=(a(335),h.a.Link),z=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={bgHeight:{height:document.documentElement.clientHeight+"px"}},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.screenChange()}},{key:"shouldComponentUpdate",value:function(e,t){return t.someData!==this.state.someData}},{key:"getLocationCity",value:function(){A("http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js").then(function(e){})}},{key:"screenChange",value:function(){var e=this;window.addEventListener("resize",function(){e.setState({bgHeight:{height:document.documentElement.clientHeight+"px"}})})}},{key:"render",value:function(){var e=this;return console.log("render"),i.a.createElement("div",{className:"home-page"},i.a.createElement(q,null),[{id:"first",text:"IV"},{id:"second",text:"HUSH"},{id:"third",text:"OHIO"},{id:"forth",text:"MYTH"}].map(function(t,n){var r={height:document.documentElement.clientHeight+"px",backgroundImage:"url(".concat(a(339)("./img"+Math.floor(17*Math.random()+1)+".jpg"),")"),backgroundSize:"cover"};return i.a.createElement("div",{key:n,id:t.id+"Page",className:"index-bg "+t.id,style:e.state.bgHeight},i.a.createElement("div",{className:"img",style:r}),i.a.createElement("div",{className:"mask",style:e.state.bgHeight},t.text),0===n&&i.a.createElement("ul",{className:"nav-ul"},i.a.createElement("li",null,i.a.createElement(g.a,{to:"/photograph"},"\u6444\u5f71")),i.a.createElement("li",null,i.a.createElement(g.a,{to:"/articles"},"\u535a\u5ba2"))))}),i.a.createElement(h.a,null,i.a.createElement("ul",{className:"anchor-list"},i.a.createElement("li",null,i.a.createElement(W,{href:"#firstPage",title:"01"})),i.a.createElement("li",null,i.a.createElement(W,{href:"#secondPage",title:"02"})),i.a.createElement("li",null,i.a.createElement(W,{href:"#thirdPage",title:"03"})),i.a.createElement("li",null,i.a.createElement(W,{href:"#forthPage",title:"04"})))))}}]),t}(n.Component),J=a(32),Y=function(e,t){return{type:"INIT_IMGS",imgs:e,pageNum:t}},K=function(e){return{type:"ADD_IMG",img:e}},Q=function(e){return{type:"DELETE_IMG",imgIndex:e}},X=function(e){return{type:"ADD_IMG_FAVOR",index:e}},Z=function(e,t){return{type:"INIT_ARTICLES",articles:e,pageNum:t}},$=function(e){return{type:"SET_CUR_ARTICLE",article:e}},ee=function(e){return{type:"INIT_TAGS",tags:e}},te=Object(s.b)({imgsReducer:function(e,t){switch(e||(e={imgs:[],curImg:{}}),t.type){case"INIT_IMGS":return t.pageNum>1?Object(O.a)({},e,{imgs:Object(J.a)(e.imgs).concat(Object(J.a)(t.imgs))}):Object(O.a)({},e,{imgs:t.imgs});case"ADD_IMG":return Object(O.a)({},e,{imgs:[t.img].concat(Object(J.a)(e.imgs))});case"DELETE_IMG":return Object(O.a)({},e,{imgs:Object(J.a)(e.imgs.slice(0,t.imgIndex)).concat(Object(J.a)(e.imgs.slice(t.imgIndex+1)))});case"ADD_IMG_FAVOR":var a=[];return e.imgs.forEach(function(e,n){a.push(e),n===t.index&&(a[n].favor_count=(e.favor_count||0)+1)}),Object(O.a)({},e,{imgs:a});default:return e}},articlesReducer:function(e,t){switch(e||(e={articles:[],curArticle:null,tags:[]}),t.type){case"INIT_ARTICLES":return t.pageNum>1?Object(O.a)({},e,{articles:Object(J.a)(e.articles).concat(Object(J.a)(t.articles))}):Object(O.a)({},e,{articles:t.articles});case"DELETE_ARTICLE":return Object(O.a)({},e,{articles:Object(J.a)(e.articles.slice(0,t.articleIndex)).concat(Object(J.a)(e.articles.slice(t.articleIndex+1)))});case"SET_CUR_ARTICLE":var a=t.article;return Object(O.a)({},e,{curArticle:a});case"INIT_TAGS":return Object(O.a)({},e,{tags:t.tags});case"ADD_TAG":return Object(O.a)({},e,{tags:[t.tag].concat(Object(J.a)(e.tags))});case"DELETE_TAG":return Object(O.a)({},e,{tags:Object(J.a)(e.tags.slice(0,t.tagIndex)).concat(Object(J.a)(e.tags.slice(t.tagIndex+1)))});default:return e}},commonReducer:function(e,t){switch(e||(e={curNav:"",isLogined:Boolean(window.localStorage.getItem("user")),isAdmin:"1"===window.localStorage.getItem("type")}),t.type){case"CHANGE_CUR_NAV":return Object(O.a)({},e,{curNav:t.nav});case"CHANGE_LOGIN_STATUS":return Object(O.a)({},e,{isLogined:t.isLogined});case"CHANGE_USER_TYPE":return console.log("isAdmin",t.isAdmin),Object(O.a)({},e,{isAdmin:t.isAdmin});default:return e}}}),ae=(a(357),a(358),a(467)),ne=a(666),ie=a(1),re=a.n(ie),ce=a(15),se=["rgba(106,10,171,.3)","rgba(199,0,125,.3)","rgba(52,21,176,.3)","rgba(68,3,111,.3)","rgba(64,19,175,.3)","rgba(166,0,166,.3)","rgba(108,0,108,.3)"],oe=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).toImgDetailPage=function(e){a.context.router.history.push("/photograph/detail/".concat(e))},a.toGroupImg=function(e,t){e.stopPropagation(),a.context.router.history.push("/photograph/group/".concat(t))},a.state={imgBoxStyle:{background:se[Math.floor(Math.random()*se.length)],height:""},showGroupBtn:!1},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.onResizeHandler()}},{key:"componentDidMount",value:function(){this.setState({showGroupBtn:-1===this.context.router.history.location.pathname.indexOf("group")}),this.onResizeHandler(),window.onresize=this.resizeThrottle(this.onResizeHandler.bind(this),500,!0)}},{key:"onResizeHandler",value:function(){var e=this.refs.imgBox.clientWidth*(this.props.img.h/this.props.img.w);this.refs.imgBox.style.height=e+"px"}},{key:"resizeThrottle",value:function(e,t,a){var n=null;return function(){var i=this,r=arguments;a&&(e.apply(this,r),a=!1),n||(n=setTimeout(function(){console.log("timer is null"),e.apply(i,r),n=null},t))}}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"img-wraper",onClick:this.toImgDetailPage.bind(this,this.props.img._id)},i.a.createElement("div",{className:"img-box",ref:"imgBox",style:this.state.imgBoxStyle},i.a.createElement("img",{src:this.props.img.src,alt:""})),i.a.createElement("div",{className:"img-cover"},i.a.createElement("div",{className:"operate-box"},i.a.createElement("div",null,i.a.createElement(ce.a,{className:"heart-icon",type:"heart",onClick:function(t){return e.props.addImgFavor(t,e.props.img._id,e.props.index)}}),i.a.createElement("span",{className:"count-span"},this.props.img.favor_count||0),this.state.showGroupBtn&&i.a.createElement(ce.a,{type:"switcher",className:"collection-icon",onClick:function(t){e.toGroupImg(t,e.props.img.group_id)}}),this.props.isAdmin&&i.a.createElement(ce.a,{type:"delete",className:"collection-icon",onClick:function(t){e.props.onDeleteImg(t,e.props.img,e.props.index)}}))),i.a.createElement("div",{className:"info-box"},this.props.img.title)))}}]),t}(n.Component);oe.contextTypes={router:re.a.object.isRequired};var le=a(211),ue=a.n(le),me=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,this.props.imgs.length>0&&i.a.createElement(ue.a,{disableImagesLoaded:!1,updateOnEachImageLoad:!1,options:{transitionDuration:0}},this.props.imgs.map(function(t,a){return i.a.createElement(oe,{img:t,key:a,index:a,addImgFavor:e.props.addImgFavor.bind(e),onDeleteImg:e.props.onDeleteImg.bind(e),isAdmin:e.props.isAdmin})})),0===this.props.imgs.length&&i.a.createElement("div",{style:{textAlign:"center"}},"\u6682\u65e0\u6570\u636e"))}}]),t}(n.Component);me.defaultProps={imgs:[]};var pe=a(672),de=a(674),he=a(203),ge=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).state={previewVisible:!1,previewImage:"",fileList:[]},a.handleCancel=function(){return a.setState({previewVisible:!1})},a.handlePreview=function(e){a.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0})},a.onUploadRemove=function(e){var t=e.uid;a.state.fileList.forEach(function(e,n){if(t===e.uid)return a.state.fileList.splice(n,1),!1}),a.setState({fileList:a.state.fileList}),a.props.getUploadList(a.state.fileList)},a.handleChange=function(e){var t=e.fileList;console.log("change",t)},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"upload",value:function(e){var t=new FormData;t.append(e.filename,e.file);var a=this;this.getImgWH(e.file,function(){D(t).then(function(t){200===t.data.resCode&&(a.state.fileList.push({name:t.data.fileName,status:"done",url:t.data.url,w:e.file.w,h:e.file.h}),a.state.fileList.forEach(function(e,t){e.uid=t}),a.setState({fileList:a.state.fileList}),a.props.getUploadList(a.state.fileList))})})}},{key:"getImgWH",value:function(e,t){var a=new FileReader;a.onload=function(a){var n=a.target.result,i=new Image;i.onload=function(){e.w=this.width,e.h=this.height,t()},i.src=n},a.readAsDataURL(e)}},{key:"render",value:function(){var e=this.state,t=e.previewVisible,a=e.previewImage,n=e.fileList,r=i.a.createElement("div",null,i.a.createElement(ce.a,{type:"plus"}),i.a.createElement("div",{className:"ant-upload-text"},"Upload"));return i.a.createElement("div",{className:"clearfix"},i.a.createElement(pe.a,{listType:"picture-card",multiple:!0,fileList:n,customRequest:this.upload.bind(this),onPreview:this.handlePreview,onRemove:this.onUploadRemove,onChange:this.handleChange},n.length>=3?null:r),i.a.createElement(de.a,{visible:t,footer:null,onCancel:this.handleCancel},i.a.createElement("img",{alt:"example",style:{width:"100%"},src:a})))}}]),t}(i.a.Component),fe=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).handleOk=function(e){a.props.form.validateFields(function(e,t){if(!e){var n={imgs:a.state.imgList,info:a.props.form.getFieldsValue()};R(n).then(function(e){var t=e.data;200===t.resCode&&(a.props.visibleHandler(!1),a.setState({imgList:[]}),a.props.form.resetFields(),t.imglist.forEach(function(e){e.title=n.info.title,a.props.onAddImg(e)}))})}})},a.handleCancel=function(e){a.props.visibleHandler(!1)},a.getUploadList=function(e){a.setState({imgList:e}),console.log("\u63a5\u53d7\u5b50\u7ec4\u4ef6filelist",a.state.imgList)},a.state={imgList:[]},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=["\u5efa\u7b51","\u4eba\u50cf","\u8857\u62cd","\u98ce\u666f","\u5176\u4ed6"],t=this.props.form.getFieldDecorator,a=he.a.Option;return i.a.createElement(de.a,{width:"40%",title:"\u4e0a\u4f20\u7167\u7247",visible:this.props.visible,onOk:this.handleOk,onCancel:this.handleCancel},i.a.createElement(ge,{getUploadList:this.getUploadList.bind(this)}),i.a.createElement(y.a,{layout:"inline",onSubmit:this.handleOk},i.a.createElement(y.a.Item,{label:"\u7c7b\u522b"},t("category",{initialValue:e[0]})(i.a.createElement(he.a,{style:{width:100},onChange:this.handleTypeChange},e.map(function(e,t){return i.a.createElement(a,{key:t,value:e},e)})))),i.a.createElement(y.a.Item,{label:"\u6807\u9898"},t("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7167\u7247\u6807\u9898"}]})(i.a.createElement(N.a,{placeholder:"\u4e3a\u8fd9\u7ec4\u7167\u7247\u8d77\u4e2a\u540d\u5b57\u5427"})))))}}]),t}(n.Component),ve=y.a.create({name:"artile-form"})(fe),be=a(679),Ee=a(676),ye=[{text:"\u6240\u6709\u6587\u7ae0"},{text:"\u7b14\u8bb0",type:0},{text:"\u751f\u6d3b",type:1},{text:"Tags",url:"/articles/tags"},{text:"\u6444\u5f71",url:"/photograph"}],Ne=[{text:"\u6240\u6709\u7167\u7247"},{text:"\u5efa\u7b51"},{text:"\u4eba\u50cf"},{text:"\u8857\u62cd"},{text:"\u98ce\u666f"},{text:"\u5176\u4ed6"},{text:"\u535a\u5ba2",url:"/articles"}],je=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).navClickHandler=function(e,t){if(!e.child&&!e.url){var n="";a.setState({activeIndex:t,showMenu:!1}),0!==a.props.type?(n="/articles",void 0!==e.type&&(n+="?type=".concat(e.type)),a.props.handleNavChange&&a.props.handleNavChange(e.type)):(n="/photograph",n+="?type=".concat(e.text),a.props.handleNavChange&&a.props.handleNavChange(e.text)),a.context.router.history.push(n),a.props.changeCurNav&&a.props.changeCurNav(a.state.navArr[t].text)}},a.state={activeIndex:0,navArr:0===a.props.type?Ne:ye,showMenu:!1,isLargeScreen:!0,loginText:"\u9000\u51fa"},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.documentElement.clientWidth<=960&&this.setState({isLargeScreen:!1}),this.state.navArr.forEach(function(t,a){t.text!==e.props.formParentNav&&t.text!==e.props.curNav||e.setState({activeIndex:a})})}},{key:"toggleMenu",value:function(){console.log(112),this.setState({showMenu:!this.state.showMenu})}},{key:"quitHandle",value:function(){var e=this;A("".concat(L,"/api/user/quit")).then(function(t){t&&(e.setState({isLogined:!1}),window.localStorage.removeItem("user"),window.localStorage.removeItem("type"),e.props.changeLoginStatus(!1),e.props.changeUserType(!1),e.context.router.history.push("/"))})}},{key:"loginHandle",value:function(e){Object(E.toast)(i.a.createElement(T,{type:e}),{autoClose:!1,closeOnClick:!1,draggable:!1}),this.setState({showMenu:!1})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{className:"page-header"},(this.state.isLargeScreen||this.state.showMenu)&&i.a.createElement("ul",{className:"img-nav-ul"},i.a.createElement("li",null,i.a.createElement(g.a,{to:"/"},i.a.createElement(ce.a,{type:"home",className:"index-btn"}))),this.state.navArr.map(function(t,a){var n="";if(t.child){var r=i.a.createElement(be.a,null,t.child.map(function(e,t){return i.a.createElement(be.a.Item,{key:t},i.a.createElement("span",null,e))}));n=i.a.createElement(Ee.a,{overlay:r,trigger:["click"]},i.a.createElement("span",{onClick:e.navClickHandler.bind(e,t.child,a)},t.text,i.a.createElement(ce.a,{type:"down"})))}else n=t.url?i.a.createElement(g.a,{to:t.url},t.text):i.a.createElement("span",null,t.text);return i.a.createElement("li",{key:a,onClick:e.navClickHandler.bind(e,t,a),className:a===e.state.activeIndex?"active":""},n)}),i.a.createElement("li",{className:"to-index-link"},this.props.isLogined&&i.a.createElement("span",{className:"op-btn",onClick:this.quitHandle.bind(this)},"\u9000\u51fa"),!this.props.isLogined&&i.a.createElement("span",null,i.a.createElement("span",{className:"op-btn",onClick:this.loginHandle.bind(this,1)},"\u767b\u5f55 "),i.a.createElement("span",{className:"op-btn",onClick:this.loginHandle.bind(this,0)},"\u6ce8\u518c")))),!this.state.showMenu&&i.a.createElement("div",null,i.a.createElement(g.a,{to:"/"},i.a.createElement(ce.a,{type:"home",className:"index-btn-1"})),i.a.createElement("span",{className:"current-nav"},this.props.curNav)),i.a.createElement("div",{className:"menu-icon",onClick:this.toggleMenu.bind(this)},!this.state.showMenu&&i.a.createElement("span",null,i.a.createElement(ce.a,{type:"bars"})),this.state.showMenu&&i.a.createElement(ce.a,{type:"close"}))),this.state.showMenu&&i.a.createElement("div",{className:"nav-mask"}))}}]),t}(n.Component);je.contextTypes={router:re.a.object.isRequired};var Oe=Object(o.b)(function(e){return{curNav:e.commonReducer.curNav,isLogined:e.commonReducer.isLogined,isAdmin:e.commonReducer.isAdmin}},function(e){return{changeCurNav:function(t){e(I(t))},changeLoginStatus:function(t){e(k(t))},changeUserType:function(t){e(C(t))}}})(je),Ie=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"handleClick",value:function(){this.props.loadMore()}},{key:"render",value:function(){var e=this.props.show?"\u6b63\u5728\u52a0\u8f7d":"\u52a0\u8f7d\u66f4\u591a";return i.a.createElement("div",{className:"loading-wrap"},this.props.show&&i.a.createElement(ae.a,{size:"small"}),i.a.createElement("span",{onClick:this.handleClick.bind(this)},e," "))}}]),t}(n.Component),ke=(a(202),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).visibleHandler=function(e){a.setState({dialogVisible:e})},a.state={dialogVisible:!1,loading:!1,showLoading:!1,pageNum:1,noMore:!1},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){!this.props.curNav||["\u6240\u6709\u7167\u7247","\u6240\u6709\u6587\u7ae0","\u7b14\u8bb0","\u751f\u6d3b","Tags"].indexOf(this.props.curNav)>=0?(this.props.changeCurNav("\u6240\u6709\u7167\u7247"),this.loadImgs()):this.loadImgs(this.props.curNav)}},{key:"loadImgs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a={pageNum:this.state.pageNum,category:t};return 1===a.pageNum?(this.setState({loading:!0}),this.props.initImgs([],this.state.pageNum)):this.setState({showLoading:!0}),function(e){return A("".concat(L,"/api/imgs?pageNum=").concat(e.pageNum,"&category=").concat(e.category))}(a).then(function(t){var a=t.data;a?(e.props.initImgs(a.imgs,e.state.pageNum),e.setState({noMore:a.noMore,showLoading:!1,loading:!1})):e.setState({showLoading:!1,loading:!1,noMore:!0})})}},{key:"loadMore",value:function(){this.setState({pageNum:this.state.pageNum+1},function(){this.loadImgs()})}},{key:"handleDeleteImg",value:function(e,t,a){var n=this,i=t.src,r=t._id,c=t.group_id,s=(i=i.split("/"))[i.length-1];e.stopPropagation(),M({_id:r,imgName:s,group_id:c}).then(function(e){e.data&&n.props.deleteImg(a)})}},{key:"handleAddImgFavor",value:function(e,t,a){var n=this;e.stopPropagation(),H(t).then(function(e){e.data&&n.props.addImgFavorCount(a)})}},{key:"handleNavChange",value:function(e){this.setState({pageNum:1}),e="\u6240\u6709\u7167\u7247"===e?"":e,this.loadImgs(e)}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(Oe,{type:0,handleNavChange:this.handleNavChange.bind(this)}),i.a.createElement(q,null),i.a.createElement("div",{className:"container img-container"},this.props.isAdmin&&i.a.createElement(j.a,{type:"primary",className:"common-btn",onClick:this.visibleHandler.bind(this,!0)},"\u4e0a\u4f20\u7167\u7247"),i.a.createElement(ve,{visible:this.state.dialogVisible,visibleHandler:this.visibleHandler,onAddImg:this.props.addImg}),i.a.createElement(ae.a,{spinning:this.state.loading},i.a.createElement(me,{imgs:this.props.imgs,addImgFavor:this.handleAddImgFavor.bind(this),onDeleteImg:this.handleDeleteImg.bind(this),isAdmin:this.props.isAdmin})),!this.state.noMore&&i.a.createElement(Ie,{show:this.state.showLoading,loadMore:this.loadMore.bind(this)})),i.a.createElement(ne.a,{target:function(){return document.getElementsByClassName("container")[0]}}))}}]),t}(n.Component)),Ce=Object(o.b)(function(e){return{imgs:e.imgsReducer.imgs,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initImgs:function(t,a){e(Y(t,a))},deleteImg:function(t){e(Q(t))},addImg:function(t){e(K(t))},changeCurNav:function(t){e(I(t))},addImgFavorCount:function(t){e(X(t))}}})(ke),xe=a(678),we=a(673),Te=a(667),Ae=a(668),Se=N.a.TextArea,_e=function(e){var t=e.comments;return i.a.createElement(we.a,{dataSource:t,header:"".concat(t.length," \u6761\u8bc4\u8bba"),itemLayout:"horizontal",renderItem:function(e){return i.a.createElement(Te.a,e)}})},Le=function(e){var t=e.onChange,a=e.onSubmit,n=e.submitting,r=e.value;return i.a.createElement("div",null,i.a.createElement(y.a.Item,null,i.a.createElement(Se,{rows:4,onChange:t,value:r})),i.a.createElement(y.a.Item,null,i.a.createElement(j.a,{className:"common-btn",htmlType:"submit",loading:n,onClick:a,type:"primary"},"\u8bc4\u8bba")))},Re=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(m.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(i)))).state={submitting:!1,value:"",comments:[]},a.handleSubmit=function(){a.state.value&&(a.setState({submitting:!0}),a.props.onSubmit({receiver:a.props.receiver,content:a.state.value},function(e){if(e.data&&e.data.comment){var t=e.data.comment,n="";n=t.sender===a.props.receiver?"\u4f5c\u8005":window.localStorage.getItem("user"),a.setState({submitting:!1,value:"",comments:[{author:n,avatar:t.avatar||"",content:a.state.value,created_at:t.created_at}].concat(Object(J.a)(a.state.comments))})}else a.setState({submitting:!1})}))},a.handleChange=function(e){a.setState({value:e.target.value})},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({comments:e.comments})}},{key:"render",value:function(){var e=this,t=this.state,a=t.submitting,n=t.value,r=this.state.comments.map(function(t){var a,n="";return t.user&&t.user.avatar&&(n=t.user.avatar),t.avatar&&(n=t.avatar),a={avatar:n,content:i.a.createElement("p",null,t.content),datetime:t.created_at},t.sender===e.props.receiver?a.author="\u4f5c\u8005":a.author=t.author||t.senderInfo,a});return i.a.createElement("div",null,r.length>0&&i.a.createElement(_e,{comments:r}),i.a.createElement(Te.a,{avatar:i.a.createElement(Ae.a,{src:"",alt:""}),content:i.a.createElement(Le,{onChange:this.handleChange,onSubmit:this.handleSubmit,submitting:a,value:n})}))}}]),t}(n.Component),De=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).resizeImgHandler=function(){a.setState({imgEnlargeble:!a.state.imgEnlargeble})},a.handleSubmit=function(e,t){G(a.state.id,e).then(function(e){e&&t&&t(e)})},a.lastOrNextImg=function(e){a.getImgDetail(a.state.id,e)},a.toGroupImg=function(e){a.context.router.history.push("/photograph/group/".concat(e))},a.state={loading:!1,id:a.props.match.params.id,imgEnlargeble:!1,comments:[],img:{},curPage:0,clickTypeNum:0},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.getImgDetail(this.state.id)}},{key:"getImgDetail",value:function(e,t){var a=this;this.setState({loading:!0}),function(e,t){return A("".concat(L,"/api/imgs/").concat(e,"?typeNum=").concat(t))}(e,t).then(function(e){var n=e.data;n&&(n.noMore?(xe.a.warning("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u5f20\u4e86",1),a.setState({clickTypeNum:t})):(a.setState({img:n.img[0],id:n.img[0]._id,clickTypeNum:0,comments:n.comment}),a.context.router.history.push("/photograph/detail/".concat(n.img[0]._id)),a.handleBrowser()),a.setState({loading:!1}))})}},{key:"handleBrowser",value:function(){var e=this;setTimeout(function(){var t,a;(t=e.state.id,A("".concat(L,"/api/imgs/").concat(t,"/addImgPv"),{num:a})).then(function(t){if(t.data){var a=Object.assign(e.state.img,{pv:(e.state.img.pv||0)+1});e.setState({img:a})}})},2e3)}},{key:"clickImgFavorHandler",value:function(){var e=this;H(this.state.id).then(function(t){if(t.data){var a=Object.assign(e.state.img,{favor_count:(e.state.img.favor_count||0)+1});e.setState({img:a})}})}},{key:"goBack",value:function(){this.context.router.history.push("/photograph")}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"img-detail-page"},i.a.createElement(q,null),i.a.createElement(ae.a,{spinning:this.state.loading},i.a.createElement("div",{className:["img-switch-wraper",this.state.imgEnlargeble?"active":""].join(" ")},i.a.createElement("div",{className:"center-box"},!this.state.imgEnlargeble&&i.a.createElement(ce.a,{type:"close",className:"icon close-icon",onClick:this.goBack.bind(this)}),i.a.createElement(ce.a,{type:"left",className:"icon left-icon",onClick:this.lastOrNextImg.bind(this,-1)}),i.a.createElement("img",{src:this.state.img.src,alt:""}),i.a.createElement(ce.a,{type:this.state.imgEnlargeble?"shrink":"arrows-alt",className:"icon size-icon",onClick:this.resizeImgHandler.bind(this)}),i.a.createElement(ce.a,{type:"right",className:"icon right-icon",onClick:this.lastOrNextImg.bind(this,1)}))),i.a.createElement("div",{className:"detail-box"},i.a.createElement("div",{className:"operate-box"},i.a.createElement("div",null,i.a.createElement(ce.a,{className:"icon heart-icon",type:"heart",onClick:this.clickImgFavorHandler.bind(this)}),i.a.createElement("span",{className:"count-span"},this.state.img.favor_count||0),i.a.createElement(ce.a,{className:"icon",type:"eye"}),i.a.createElement("span",{className:"count-span"},this.state.img.pv||0),i.a.createElement(ce.a,{type:"switcher",className:"icon collection-icon",onClick:function(t){e.toGroupImg(e.state.img.groupId)}}))),i.a.createElement("div",{className:"comment-wrap"},i.a.createElement(Re,{receiver:this.state.img.author,comments:this.state.comments,onSubmit:this.handleSubmit.bind(this)})))))}}]),t}(n.Component);De.contextTypes={router:re.a.object.isRequired};var Me=Object(o.b)(function(e){return{imgs:e.imgs,curImg:e.curImg}},function(e){return{}})(De),He=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={loading:!1,groupId:a.props.match.params.id,groupInfo:{}},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){this.loadImgs(),this.props.curNav||this.props.changeCurNav("\u6240\u6709\u7167\u7247")}},{key:"loadImgs",value:function(){var e,t=this;return this.setState({loading:!0}),this.props.initImgs([],1),(e=this.state.groupId,A("".concat(L,"/api/groupImgs?groupId=").concat(e))).then(function(e){var a=e.data;a&&(t.setState({groupInfo:a.group.info}),t.props.initImgs(a.group.imgs,1)),t.setState({loading:!1})})}},{key:"handleDeleteImg",value:function(e,t,a){var n=this,i=t.src,r=t._id,c=t.group_id,s=(i=i.split("/"))[i.length-1];e.stopPropagation(),M({_id:r,imgName:s,group_id:c}).then(function(e){e.data&&n.props.deleteImg(a)})}},{key:"handleAddImgFavor",value:function(e,t,a){var n=this;e.stopPropagation(),H(t).then(function(e){e.data&&n.props.addImgFavorCount(a)})}},{key:"handleNavChange",value:function(e){this.setState({pageNum:1}),e="\u6240\u6709\u7167\u7247"===e?"":e,this.loadImgs(e)}},{key:"goBack",value:function(){this.context.router.history.push("/photograph")}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(Oe,{type:0,handleNavChange:this.handleNavChange.bind(this)}),i.a.createElement(q,null),i.a.createElement("div",{className:"container img-container"},i.a.createElement(ae.a,{spinning:this.state.loading},i.a.createElement("div",{className:"group-info"},i.a.createElement("p",{className:"title"},this.state.groupInfo.title),i.a.createElement("ul",{className:"tag-list"},i.a.createElement("li",null,this.state.groupInfo.category)),i.a.createElement("p",{className:"date"},this.state.groupInfo.created_at)),i.a.createElement(me,{imgs:this.props.imgs,addImgFavor:this.handleAddImgFavor.bind(this),onDeleteImg:this.handleDeleteImg.bind(this),isAdmin:this.props.isAdmin}),i.a.createElement("div",{className:"group-info"},i.a.createElement(j.a,{onClick:this.goBack.bind(this)},"\u8fd4 \u56de")))))}}]),t}(n.Component);He.contextTypes={router:re.a.object.isRequired};var Pe=Object(o.b)(function(e){return{imgs:e.imgsReducer.imgs,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initImgs:function(t,a){e(Y(t,a))},deleteImg:function(t){e(Q(t))},addImg:function(t){e(K(t))},changeCurNav:function(t){e(I(t))},addImgFavorCount:function(t){e(X(t))}}})(He),Fe=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.article;return i.a.createElement("div",{className:"article-wraper"},i.a.createElement("div",{className:["cover-box",e.cover_url?"":"no-cover"].join(" ")},i.a.createElement("img",{"v-if":e.cover_url,src:e.cover_url,alt:""})),i.a.createElement("div",{className:"info"},i.a.createElement("h3",{className:"title"},i.a.createElement("p",{onClick:this.props.viewDetail.bind(this,e._id)},e.title),this.props.isAdmin&&i.a.createElement("span",{className:"operate-btn"},i.a.createElement(ce.a,{type:"delete",onClick:this.props.deleteArticle.bind(this,e._id,this.props.index,e.cover_url)}),i.a.createElement(ce.a,{type:"edit",onClick:this.props.editArticle.bind(this,e._id)}))),i.a.createElement("p",{className:"time"},e.created_at,i.a.createElement("span",null,i.a.createElement(ce.a,{type:"message",className:"icon"}),e.comments||0),i.a.createElement("span",null,i.a.createElement(ce.a,{type:"fire",className:"icon"}),e.pv||0)),i.a.createElement("div",{className:"description"},e.description)))}}]),t}(n.Component);Fe.contextTypes={router:re.a.object.isRequired};var Ue=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{className:"left"},this.props.articles.length>0&&i.a.createElement("div",null,this.props.articles.map(function(t,a){return i.a.createElement(Fe,{article:t,key:t._id,index:a,deleteArticle:e.props.deleteArticle.bind(e),editArticle:e.props.editArticle.bind(e),viewDetail:e.props.viewDetail.bind(e),isAdmin:e.props.isAdmin})})),0===this.props.articles.length&&i.a.createElement("div",{style:{textAlign:"center"}},"\u6682\u65e0\u6570\u636e")),i.a.createElement("div",{className:"right"},i.a.createElement("img",{className:"avator",alt:"",src:a(469)}),i.a.createElement("div",null,i.a.createElement("p",null,"\u597d\u597d\u5b66\u4e60, \u5929\u5929\u5411\u4e0a"),i.a.createElement("a",{target:"blank",href:"https://github.com/HuangChuFeng"},i.a.createElement(ce.a,{type:"github"})," github"))))}}]),t}(n.Component);Ue.defaultProps={articles:[]};a(148);var Ge=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).onEditArticle=function(e){a.context.router.history.push("/articles/edit/".concat(e))},a.onViewDetail=function(e){a.context.router.history.push("/articles/detail/".concat(e))},a.state={loading:!1,showLoading:!1,pageNum:1,noMore:!0},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this.context.router.route.location.search,t=e.substring(e.length-1),a=this.props.match.params.tag;if(t){this.loadArticles(t);var n="0"===t?"\u7b14\u8bb0":"\u751f\u6d3b";this.props.changeCurNav(n)}else a?this.props.getArticlesByTagName(a):this.loadArticles(),this.props.curNav||this.props.changeCurNav("\u6240\u6709\u6587\u7ae0")}},{key:"loadArticles",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a={pageNum:this.state.pageNum,type:t};this.setState({showLoading:!0}),1===a.pageNum&&(this.setState({loading:!0}),this.props.initArticles([],this.state.pageNum)),function(e){return A("".concat(L,"/api/articles?pageNum=").concat(e.pageNum,"&type=").concat(e.type))}(a).then(function(t){var a=t.data;a?(e.props.initArticles(a.articles,e.state.pageNum),e.setState({showLoading:!1}),0===a.articles.length?e.setState({noMore:!0}):e.setState({noMore:!1}),e.setState({loading:!1})):e.setState({showLoading:!1,loading:!1,noMore:!0})})}},{key:"loadMore",value:function(){this.setState({pageNum:this.state.pageNum+1},function(){this.loadArticles()})}},{key:"handleNavChange",value:function(e){this.loadArticles(e)}},{key:"onDeleteArticle",value:function(e,t,a){var n,i=this,r="";a&&(r=(a=a.split("/"))[a.length-1]),(n={articleId:e,coverName:r},A("".concat(L,"/api/articles/").concat(n.articleId,"/remove?coverName=").concat(n.coverName))).then(function(e){e.data&&i.props.deleteArticle(t)})}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(Oe,{type:1,formParentNav:"\u6240\u6709\u6587\u7ae0",handleNavChange:this.handleNavChange.bind(this)}),i.a.createElement("div",{className:"container article-container"},this.props.isAdmin&&i.a.createElement(g.a,{to:"/articles/new"},"\u5199\u6587\u7ae0"),i.a.createElement(ae.a,{spinning:this.state.loading},i.a.createElement(Ue,{articles:this.props.articles,deleteArticle:this.onDeleteArticle.bind(this),editArticle:this.onEditArticle.bind(this),viewDetail:this.onViewDetail.bind(this),isAdmin:this.props.isAdmin})),!this.state.noMore&&i.a.createElement(Ie,{show:this.state.showLoading,loadMore:this.loadMore.bind(this)}),i.a.createElement(ne.a,{target:function(){return document.getElementsByClassName("container")[0]}})))}}]),t}(n.Component);Ge.contextTypes={router:re.a.object.isRequired};var Ve=Object(o.b)(function(e){return{articles:e.articlesReducer.articles,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initArticles:function(t,a){e(Z(t,a))},getArticlesByTagName:function(t){(function(e){return A("".concat(L,"/api/tag/articles?tag=").concat(e))})(t).then(function(t){var a=t.data;a&&e(Z(a.articles))})},deleteArticle:function(t){e({type:"DELETE_ARTICLE",articleIndex:t})},changeCurNav:function(t){e(I(t))}}})(Ge),Be=a(215),qe=a.n(Be),We=(a(659),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).lastOrNextArticle=function(e){a.articleDetail(a.state.id,e)},a.handleSubmit=function(e,t){G(a.state.id,e).then(function(e){e&&t&&t(e)})},a.backListPage=function(){a.props.changeCurNav("")},a.state={loading:!1,id:a.props.match.params.id,comments:[],article:{},curPage:0,clickTypeNum:0,tags:[]},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"handleBrowser",value:function(){var e=this;setTimeout(function(){var t;(t=e.state.id,A("".concat(L,"/api/articles/").concat(t,"/addArticlePv"))).then(function(t){if(t.data){var a=Object.assign(e.state.article,{pv:(e.state.article.pv||0)+1});e.setState({article:a})}})},2e3)}},{key:"componentWillMount",value:function(){this.articleDetail(this.state.id),this.props.changeCurNav("\u6587\u7ae0\u8be6\u60c5")}},{key:"articleDetail",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.setState({loading:!0}),U(e,a).then(function(e){var n=e.data;n&&(n.noMore?(xe.a.warning("\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u7bc7\u4e86",1),t.setState({clickTypeNum:a})):(t.setState({article:n.article[0],id:n.article[0]._id,clickTypeNum:0,comments:n.comment,tags:n.tags}),t.context.router.history.push("/articles/detail/".concat(n.article[0]._id)),t.handleBrowser())),t.setState({loading:!1})})}},{key:"render",value:function(){var e;return this.state.article.created_at&&(e=this.state.article.created_at.replace(/-/g,".")),i.a.createElement("div",null,i.a.createElement(Oe,{type:1}),i.a.createElement("div",{className:"container article-detail-container"},i.a.createElement(ae.a,{spinning:this.state.loading},i.a.createElement("div",{className:"left"},i.a.createElement(g.a,{to:"/articles",onClick:this.backListPage.bind(this)},i.a.createElement(ce.a,{type:"left",className:"back-btn"})),i.a.createElement("div",{className:"top-info-box"},i.a.createElement("h2",null,this.state.article.title),i.a.createElement("div",{className:"top-bottom"},i.a.createElement("span",null,e," Beijing"),i.a.createElement("span",{className:"browse-num"},i.a.createElement(ce.a,{type:"fire",className:"fire-icon"}),this.state.article.pv||0))),i.a.createElement("div",{className:"left-bottom-box"},i.a.createElement("ul",{className:"tag-list"},this.state.tags&&this.state.tags.map(function(e){return i.a.createElement("li",{key:e._id},e.name)})),this.state.article.description),i.a.createElement("div",{className:"control-box"},i.a.createElement("span",{onClick:this.lastOrNextArticle.bind(this,-1)},"\u4e0a\u4e00\u7bc7"),i.a.createElement("span",{onClick:this.lastOrNextArticle.bind(this,1)},"\u4e0b\u4e00\u7bc7"))),i.a.createElement("div",{className:"right"},i.a.createElement(qe.a,{className:"language-name-of-snippet",innerHTML:!0},this.state.article.content),i.a.createElement(Re,{receiver:this.state.article.author,comments:this.state.comments,onSubmit:this.handleSubmit.bind(this)})))))}}]),t}(n.Component));We.contextTypes={router:re.a.object.isRequired};var ze=Object(o.b)(function(e){return{curArticle:e.articlesReducer.curArticle,articles:e.articlesReducer.articles}},function(e){return{changeCurNav:function(t){e(I(t))}}})(We),Je=a(669),Ye=a(670),Ke=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){e||console.log("Received values of form: ",t)})},a.getFormData=function(){var e;return a.props.form.validateFields(function(t,n){t||(console.log("Received values of form: ",n),e=Object.assign({tags:a.state.selectedTags,coverName:a.state.coverName,coverUrl:a.state.coverUrl},a.props.form.getFieldsValue()))}),e},a.state={selectedTags:[],loading:!1,coverUrl:"",coverName:""},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.onRef(this),this.props.form.setFieldsValue({type:0})}},{key:"componentWillReceiveProps",value:function(e){e.article&&!this.props.article&&this.initForm(e.article)}},{key:"initForm",value:function(e){var t={type:e.type,title:e.title,description:e.description};this.setState({coverUrl:e.cover_url,selectedTags:e.tags.map(function(e){return e.name})}),this.props.form.setFieldsValue(t)}},{key:"handleTagChange",value:function(e){this.setState({selectedTags:e})}},{key:"onUploadCover",value:function(e){var t=this;this.setState({loading:!0}),this.props.uploadCover(e,function(e){200===e.data.resCode&&t.setState({coverUrl:e.data.url,loading:!1,coverName:e.data.fileName})})}},{key:"render",value:function(){var e=i.a.createElement("div",null,i.a.createElement(ce.a,{type:this.state.loading?"loading":"plus"}),i.a.createElement("div",{className:"ant-upload-text"},"\u6587\u7ae0\u5c01\u9762")),t=he.a.Option,a=this.props.form.getFieldDecorator,n=[];if(this.props.allTags)for(var r=0;r<this.props.allTags.length;r++)n.push(i.a.createElement(t,{key:this.props.allTags[r].name},this.props.allTags[r].name));return i.a.createElement(y.a,{onSubmit:this.handleSubmit,className:"artile-form"},i.a.createElement(Je.a,null,i.a.createElement(Ye.a,{span:4},i.a.createElement(y.a.Item,null,a("type")(i.a.createElement(he.a,{style:{width:100}},i.a.createElement(t,{value:0},"\u7b14\u8bb0"),i.a.createElement(t,{value:1},"\u751f\u6d3b"))))),i.a.createElement(Ye.a,{span:20},i.a.createElement(y.a.Item,null,a("title",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u7ae0\u6807\u9898"}]})(i.a.createElement(N.a,{placeholder:"\u6587\u7ae0\u6807\u9898"}))))),i.a.createElement(y.a.Item,null,a("description",{rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u7ae0\u63cf\u8ff0"}]})(i.a.createElement(N.a,{placeholder:"\u63cf\u8ff0\u4e0b\u6587\u7ae0\u5427"}))),i.a.createElement(y.a.Item,null,i.a.createElement(Je.a,null,i.a.createElement(Ye.a,{span:18},i.a.createElement(he.a,{mode:"tags",placeholder:"\u9009\u62e9\u6807\u7b7e",value:this.state.selectedTags,onChange:this.handleTagChange.bind(this),style:{width:"100%"}},n)),i.a.createElement(Ye.a,{span:2}),i.a.createElement(Ye.a,{span:2},i.a.createElement(pe.a,{listType:"picture-card",className:"cover-uploader",customRequest:this.onUploadCover.bind(this),showUploadList:!1},this.state.coverUrl?i.a.createElement("img",{src:this.state.coverUrl,alt:"cover"}):e)))))}}]),t}(i.a.Component),Qe=y.a.create({name:"artile-form"})(Ke),Xe=a(216),Ze=a.n(Xe),$e=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={editorContent:""},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.onRef(this);var t=this.refs.editorElem;this.editor=new Ze.a(t),this.editor.customConfig.uploadImgShowBase64=!0,this.editor.customConfig.onchange=function(t){e.setState({editorContent:t})},this.editor.create()}},{key:"componentWillReceiveProps",value:function(e){e.article&&!this.props.article&&(this.setState({editorContent:e.article.content}),this.editor.txt.html(e.article.content))}},{key:"getContent",value:function(){return{content:this.state.editorContent}}},{key:"render",value:function(){return i.a.createElement("div",{ref:"editorElem",className:"edit-wrapper"})}}]),t}(n.Component),et=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).onRef=function(e){a.child=e},a.state={articleId:a.props.match.params.id},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=Object(b.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.articleId){e.next=3;break}return e.next=3,this.props.articleDetail(this.state.articleId);case 3:this.props.initTags();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.props.resetCurArticle()}},{key:"uploadCover",value:function(e,t){var a=new FormData;a.append(e.filename,e.file),D(a).then(function(e){200===e.data.resCode&&t&&t(e)})}},{key:"saveArticleHandler",value:function(){var e,t,a=this,n=this.form.getFormData();n&&(n=Object.assign(this.child.getContent(),n),this.state.articleId?(e=this.state.articleId,t=n,S("".concat(L,"/api/articles/").concat(e,"/update"),{article:t})).then(function(e){e.data&&a.context.router.history.push("/articles")}):function(e){return S("".concat(L,"/api/articles/create"),{article:e})}(n).then(function(e){e.data&&a.context.router.history.push("/articles")}))}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement(Oe,{type:1}),i.a.createElement("div",{className:"container edit-container"},i.a.createElement(Qe,{wrappedComponentRef:function(t){return e.form=t},article:this.props.curArticle,allTags:this.props.tags,onRef:this.onRef,uploadCover:this.uploadCover}),i.a.createElement($e,{onRef:this.onRef,article:this.props.curArticle}),i.a.createElement(j.a,{type:"primary",className:"common-btn operate-btn",onClick:this.saveArticleHandler.bind(this)},"\u53d1\u5e03"),i.a.createElement(j.a,{className:"operate-btn"},i.a.createElement(g.a,{to:"/articles"},"\u53d6\u6d88"))))}}]),t}(n.Component);et.contextTypes={router:re.a.object.isRequired};var tt=Object(o.b)(function(e){return{curArticle:e.articlesReducer.curArticle,tags:e.articlesReducer.tags}},function(e){return{initTags:function(){V().then(function(t){var a=t.data;a&&e(ee(a.tags))})},articleDetail:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return U(t,a).then(function(t){var a=t.data;if(a){var n=Object.assign({tags:a.tags},a.article[0]);e($(n))}})},resetCurArticle:function(){e($(null))}}})(et),at=a(77),nt=a(682),it=a(218),rt=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).handleClose=function(e){var t=0;try{a.props.tags.forEach(function(a,n){if(a._id===e._id)return t=n,!1})}catch(n){throw new Error("current deleted tag_id is not exist")}a.props.deleteTag(e._id,t)},a.showInput=function(){a.setState({inputVisible:!0},function(){return a.input.focus()})},a.handleInputChange=function(e){a.setState({inputValue:e.target.value})},a.handleInputConfirm=function(){var e=a.state.inputValue;a.props.addTag(e),a.setState({inputVisible:!1,inputValue:""})},a.saveInputRef=function(e){return a.input=e},a.forMap=function(e){var t=i.a.createElement(nt.a,{closable:!!a.props.isAdmin,onClose:function(t){t.preventDefault(),a.handleClose(e)}},i.a.createElement("span",{onClick:a.clickTagHandler.bind(Object(at.a)(Object(at.a)(a)),e.name)},e.name));return i.a.createElement("span",{key:e._id,style:{display:"inline-block"}},t)},a.state={inputVisible:!1,inputValue:""},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"clickTagHandler",value:function(e){this.props.clickTagHandler(e)}},{key:"render",value:function(){var e=this.state,t=e.inputVisible,a=e.inputValue,n=(this.props.tags||[]).map(this.forMap);return i.a.createElement("div",null,i.a.createElement("div",{style:{marginBottom:16}},i.a.createElement(it.a,{enter:{scale:.8,opacity:0,type:"from",duration:100,onComplete:function(e){e.target.style=""}},leave:{opacity:0,width:0,scale:0,duration:200},appear:!1},n)),t&&i.a.createElement(N.a,{ref:this.saveInputRef,type:"text",size:"small",style:{width:78},value:a,onChange:this.handleInputChange,onBlur:this.handleInputConfirm,onPressEnter:this.handleInputConfirm}),!t&&this.props.isAdmin&&i.a.createElement(nt.a,{onClick:this.showInput,style:{background:"#fff",borderStyle:"dashed"}},i.a.createElement(ce.a,{type:"plus"})," New Tag"))}}]),t}(n.Component),ct=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){var e=this;this.props.initTags(),setTimeout(function(){e.props.changeCurNav("Tags")},0)}},{key:"clickTagHandler",value:function(e){this.context.router.history.push("/articles/tags/".concat(e))}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(Oe,{type:1,formParentNav:"Tags"}),i.a.createElement("div",{className:"container article-container"},i.a.createElement(rt,{isAdmin:this.props.isAdmin,tags:this.props.tags,initTags:this.props.initTags,addTag:this.props.addTag,deleteTag:this.props.deleteTag,clickTagHandler:this.clickTagHandler.bind(this)})))}}]),t}(n.Component);ct.contextTypes={router:re.a.object.isRequired};var st=Object(o.b)(function(e){return{tags:e.articlesReducer.tags,curNav:e.commonReducer.curNav,isAdmin:e.commonReducer.isAdmin}},function(e){return{initTags:function(){V().then(function(t){var a=t.data;a&&e(ee(a.tags))})},deleteTag:function(t,a){var n;(n={tagId:t},A("".concat(L,"/api/articleTags/").concat(n.tagId,"/remove"))).then(function(t){t.data&&e(function(e){return{type:"DELETE_TAG",tagIndex:e}}(a))})},addTag:function(t){(function(e){return S("".concat(L,"/api/articleTags/create"),e)})({name:t}).then(function(t){var a=t.data;a&&e({type:"ADD_TAG",tag:a.res})})},changeCurNav:function(t){e(I(t))}}})(ct),ot=a(681),lt=a(680),ut=(a(661),Object(s.c)(te));console.log("NODE_ENV","production"),c.a.render(i.a.createElement(o.a,{store:ut},i.a.createElement(ot.a,null,i.a.createElement("div",null,i.a.createElement(lt.a,{exact:!0,path:"/",component:z}),i.a.createElement(lt.a,{exact:!0,path:"/photograph",component:Ce}),i.a.createElement(lt.a,{exact:!0,path:"/photograph/detail/:id",component:Me}),i.a.createElement(lt.a,{exact:!0,path:"/photograph/group/:id",component:Pe}),i.a.createElement(lt.a,{exact:!0,path:"/articles",component:Ve}),i.a.createElement(lt.a,{exact:!0,path:"/articles/detail/:id",component:ze}),i.a.createElement(lt.a,{exact:!0,path:"/articles/new",component:tt}),i.a.createElement(lt.a,{exact:!0,path:"/articles/edit/:id",component:tt}),i.a.createElement(lt.a,{exact:!0,path:"/articles/tags",component:st}),i.a.createElement(lt.a,{exact:!0,path:"/articles/tags/:tag",component:Ve}),i.a.createElement(E.ToastContainer,null)))),document.getElementById("root"))}},[[220,2,1]]]);
//# sourceMappingURL=main.8f678055.chunk.js.map